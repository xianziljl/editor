{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?a14c","webpack:///./src/components/editor/tool/items/toolItemMixin.js","webpack:///./src/components/editor/tool/items/bold.js","webpack:///./src/components/editor/tool/items/italic.js","webpack:///./src/components/editor/tool/items/link.js","webpack:///./src/components/editor/tool/items/code.js","webpack:///./src/components/editor/tool/items/hilight.js","webpack:///./src/components/editor/tool/items/strikethrough.js","webpack:///./src/components/editor/tool/items/blockquote.js","webpack:///./src/components/editor/tool/items/unorderlist.js","webpack:///./src/components/editor/tool/items/orderlist.js","webpack:///./src/components/editor/tool/items/todolist.js","webpack:///./src/components/editor/tool/items/heading1.js","webpack:///./src/components/editor/tool/items/heading2.js","webpack:///./src/components/editor/tool/items/delete.js","webpack:///./src/components/editor/utils/createGUID.js","webpack:///./src/components/editor/tool/items/image.js","webpack:///./src/components/editor/tool/items/video.js","webpack:///./src/components/editor/tool/items/divider.js","webpack:///./src/components/editor/tool/items/blockcode.js","webpack:///./src/components/editor/tool/popup-tool-map.js","webpack:///./src/components/editor/tool/popup-tool.js","webpack:///./src/components/editor/blocks/block-mixin.js","webpack:///./src/components/editor/text/text-render.js","webpack:///./src/components/editor/blocks/heading/heading.js","webpack:///./src/components/editor/blocks/paragraph/paragraph.js","webpack:///./src/components/editor/blocks/blockquote/blockquote.js","webpack:///./src/components/editor/blocks/divider/divider.js","webpack:///./src/components/editor/blocks/lists/listitem.js","webpack:///./src/components/editor/blocks/lists/checkbox.js","webpack:///./src/components/editor/blocks/lists/todoitem.js","webpack:///./src/components/editor/blocks/image/image.js","webpack:///./src/components/editor/blocks/image/images.js","webpack:///./src/components/editor/blocks/blockcode/blockcode.js","webpack:///./src/components/editor/blocks/video/video.js","webpack:///./src/components/editor/map.js","webpack:///./src/components/editor/utils/editor-util.js","webpack:///./src/components/editor/tool/add-tool.js","webpack:///./src/components/editor/tool/tool-tip.js","webpack:///./src/components/editor/blocks/block-render.js","webpack:///./src/components/editor/utils/formatValue.js","webpack:///./src/components/editor/formatters.js","webpack:///./src/components/editor/editor.js","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue","webpack:///./src/store.js","webpack:///./src/main.js","webpack:///./src/App.vue?bcb1"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_vm","this","_h","$createElement","_c","_self","attrs","staticClass","ref","readonly","testValue","on","getValue","_v","$event","_s","staticRenderFns","inject","isActive","isDisabled","render","h","class","$options","disabled","click","onClick","mixins","toolItemMixin","watch","styles","bold","methods","e","$editor","toggleInlineStyle","isOperating","italic","isInput","link","children","input","placeholder","keydown","onKeydown","inlineStyles","selection","$nextTick","$el","querySelector","focus","stopPropagation","isComposing","keyCode","preventDefault","target","href","$tool","close","code","hilight","strikethrough","style","toggleBlockType","level","startBlock","removeBlock","clearSelection","createGUID","replace","Math","random","v","toString","multiple","block","type","accept","display","change","onChange","tabindex","files","Array","from","isChangeImage","rowId","row","substr","images","map","item","imgData","id","src","URL","createObjectURL","alt","text","width","height","file","image","index","blocks","indexOf","forEach","addBlockAt","isShow","isChangeVideo","video","poster","toolMap","Bold","Italic","Link","Code","Hilight","Strikethrough","Blockquote","Orderlist","Unorderlist","Todolist","Heading1","Heading2","Delete","Image","Video","Divider","Blockcode","common","toolItems","paragraph","heading1","heading2","heading3","heading4","blockquote","orderlist","unorderlist","todolist","blockcode","imagetext","divider","toolMaps","position","items","provide","x","y","arrowX","left","top","mousedown","onMousedown","isSelecting","rangeRect","getPosition","val","PADDING","clientWidth","clientHeight","innerWidth","parentNode","props","Boolean","default","createLinkNode","context","child","_href","ctrlKey","metaKey","open","ranges","inlines","createTextNode","points","Set","range","start","offset","end","add","sort","a","b","innerText","el","tagName","spanMap","has","linkNode","blockMixin","renderText","isSelected","includes","blockMxin","checked","contenteditable","$emit","console","log","texts","checkbox","Checkbox","assign","$listeners","desc","img","draggable","load","naturalWidth","naturalHeight","descClass","paste","selectionchange","flex","controls","loadedmetadata","readyState","videoWidth","videoHeight","underline","blockMap","heading","Heading","Paragraph","Listitem","Todoitem","Images","textBlockMap","listTypes","isTextBlock","getBlockNodeByChildNode","node","dataset","getNodeById","document","getBlockById","filter","getSelectedBlocks","startId","endId","go","getRangeRect","getBoundingClientRect","elRect","getOffset","root","_offset","getRootChildNode","_root","_node","rootChildNode","childNodes","nodes","len","nodeType","getRangeStyles","itemEnd","isAtStart","mergeRanges","each","arr","item1","item2","s1","e1","s2","e2","min","max","splitRange","baseRange","cutRange","getFocusNodeAndOffset","getResult","focusNode","focusOffset","skipCheck","itemLength","replaceRange","inputLength","rangeStart","rangeEnd","changeLength","itemStart","splitBlock","text1","text2","ranges1","ranges2","newRange","undefined","mergeBlocks","block1","block2","concat","isOpen","endBlock","addBtn","btns","btnsContainer","nodeHeight","rect","restoreSelection","isEnter","content","timer","arrow","mounted","addListeners","editorEl","addEventListener","onMouseenter","onMouseleave","$once","removeEventListener","tip","setTimeout","clearTimeout","renderBlocks","list","component","dataindex","next","listNode","formatValue","$set","reg","match","isHistoryBacking","isFocus","startOffset","endOffset","blockStyle","history","article","toolPopup","addTool","toolTip","onInput","onPaste","compositionstart","onCompositionstart","compositionend","onCompositionend","drop","onDrop","onFocus","ToolPopup","ToolAdd","ToolTip","errorCaptured","err","vm","info","removeListeners","handler","debounce","historyForward","deep","onSelectionchange","onPageMousedown","onPageMouseup","path","composedPath","srcElement","$refs","onInputCrossBlocks","newOffset","setSelection","oldLength","newLength","formated","formatters","format","res","range1","substring","range2","clipboardData","getData","split","ctrl","onKeyBackspace","onKeyTab","onKeyEsc","onKeyEnter","historyBack","vblocks","prevBlock","prevBlockNode","clearBlockType","prevTextLen","newBlock","prev","getSelection","removeAllRanges","getSelectedBlockStyle","getSelectedInlineStyles","anchorNode","getRangeAt","startContainer","endContainer","startNode","endNode","selectedBlocks","pop","_blocks","stylesMap","addInlineStyle","removeInlineStyle","handleItem","focusRange","newRanges","setBlockType","isSame","createRange","setStart","setEnd","addRange","warn","message","JSON","parse","stringify","historyItem","components","editor","onFileChange","url","body","appendChild","Vue","use","Vuex","Store","state","mutations","actions","config","productionTip","store","App","$mount"],"mappings":"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","file":"js/app.f646676d.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/editor/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('div',{staticClass:\"main\"},[_c('div',{staticClass:\"editor-container\"},[_c('editor',{ref:\"editor\",attrs:{\"readonly\":_vm.readonly,\"value\":_vm.testValue}})],1)]),_c('button',{on:{\"click\":_vm.getValue}},[_vm._v(\"Get value\")]),_c('button',{on:{\"click\":function($event){_vm.readonly = !_vm.readonly}}},[_vm._v(\"readonly: \"+_vm._s(_vm.readonly))])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default {\n  inject: ['$editor', '$tool'],\n  data () {\n    return {\n      isActive: false,\n      isDisabled: false\n    }\n  },\n  render (h) {\n    return h('button', {\n      class: [\n        'editor-tool-btn',\n        this.$options.name,\n        this.isActive ? 'editor-tool-btn-on' : '',\n        this.isDisabled ? 'editor-tool-btn-disabled' : ''\n      ],\n      attrs: {\n        disabled: this.isDisabled\n      },\n      on: {\n        click: this.onClick\n      }\n    })\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-bold',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.bold\n    }\n  },\n  methods: {\n    onClick (e) {\n      this.$editor.toggleInlineStyle('bold')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-italic',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.italic\n    }\n  },\n  methods: {\n    onClick (e) {\n      this.$editor.toggleInlineStyle('italic')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-link',\n  mixins: [toolItemMixin],\n  data () {\n    return {\n      isInput: false // \n    }\n  },\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.link\n    },\n    '$tool.isShow' () {\n      this.isInput = false\n    }\n  },\n  render (h) {\n    const children = [h('button', {\n      class: [\n        'editor-tool-btn',\n        'editor-tool-link',\n        this.isActive ? 'editor-tool-btn-on' : ''\n      ],\n      on: {\n        click: this.onClick\n      }\n    })]\n    if (this.isInput) {\n      const input = h('input', {\n        attrs: { placeholder: '' },\n        on: { keydown: this.onKeydown }\n      })\n      children.push(input)\n    }\n    return h('div', {\n      class: 'editor-tool--link'\n    }, children)\n  },\n  methods: {\n    onClick (e) {\n      const { inlineStyles } = this.$editor.selection\n      if (inlineStyles.link) {\n        this.$editor.toggleInlineStyle('link')\n        this.$editor.isOperating = false\n        this.isInput = false\n      } else {\n        this.isInput = true\n        this.$nextTick(() => {\n          this.$el.querySelector('input').focus()\n        })\n      }\n    },\n    onKeydown (e) {\n      // console.log(e.keyCode)\n      e.stopPropagation()\n      if (e.isComposing) return\n      if (e.keyCode === 13) {\n        e.preventDefault()\n        if (!e.target.value) return\n        this.$editor.toggleInlineStyle('link', { href: e.target.value })\n        this.$editor.isOperating = false\n        this.$tool.close()\n        this.isInput = false\n        return\n      }\n      if (e.keyCode === 27) {\n        this.$editor.isOperating = false\n        this.$tool.close()\n        this.isInput = false\n      }\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-code',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.code\n    }\n  },\n  methods: {\n    onClick (e) {\n      this.$editor.toggleInlineStyle('code')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-hilight',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.hilight\n    }\n  },\n  methods: {\n    onClick (e) {\n      this.$editor.toggleInlineStyle('hilight')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\nexport default {\n  name: 'editor-tool-strikethrough',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.inlineStyles' (styles) {\n      this.isActive = styles && styles.strikethrough\n    }\n  },\n  methods: {\n    onClick (e) {\n      this.$editor.toggleInlineStyle('strikethrough')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-blockquote',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'blockquote'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('blockquote')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-unorderlist',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'unorderlist'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('unorderlist')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-orderlist',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'orderlist'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('orderlist')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-todolist',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'todolist'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('todolist')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-heading-1',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'heading1'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('heading', { level: 1 })\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-heading-2',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'heading2'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('heading', { level: 2 })\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-delete',\n  mixins: [toolItemMixin],\n  methods: {\n    onClick (e) {\n      const { startBlock } = this.$editor.selection\n      this.$editor.removeBlock(startBlock)\n      this.$editor.clearSelection()\n      this.$editor.isOperating = false\n    }\n  }\n}\n","function createGUID () {\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n    let r = Math.random() * 16 | 0\n    let v = c === 'x' ? r : (r & 0x3 | 0x8)\n    return v.toString(16)\n  })\n}\n\nexport default createGUID\n","import createGUID from '../../utils/createGUID'\n\nexport default {\n  name: 'editor-tool-image',\n  inject: ['$editor', '$tool'],\n  data () {\n    return {\n      multiple: true\n    }\n  },\n  watch: {\n    '$editor.selection.startBlock' (block) {\n      this.multiple = !(block && block.type === 'image')\n    }\n  },\n  render (h) {\n    const input = h('input', {\n      attrs: {\n        type: 'file',\n        accept: 'image/jpg, image/jpeg, image/png, image/gif',\n        multiple: this.multiple\n      },\n      style: {\n        display: 'none'\n      },\n      on: {\n        change: this.onChange\n      }\n    })\n    return h('label', {\n      class: ['editor-tool-btn', 'editor-tool-image'],\n      attrs: { tabindex: 0 }\n    }, [input])\n  },\n  methods: {\n    onChange (e) {\n      let files = e.target.files\n      if (!files.length) return\n      files = Array.from(files)\n      const { startBlock } = this.$editor.selection\n      if (!startBlock) return\n      const isChangeImage = startBlock.type === 'image'\n      const rowId = isChangeImage ? startBlock.row : Math.random().toString(16).substr(2)\n      const images = files.map(item => {\n        const imgData = {\n          type: 'image',\n          id: isChangeImage ? startBlock.id : createGUID(),\n          key: 0,\n          src: URL.createObjectURL(item),\n          alt: item.name,\n          text: '',\n          width: 0,\n          height: 0,\n          row: rowId,\n          file: item\n        }\n        return imgData\n      })\n      if (isChangeImage) {\n        const image = images[0]\n        for (let key in image) startBlock[key] = image[key]\n      } else {\n        let index = this.$editor.value.blocks.indexOf(startBlock)\n        this.$editor.removeBlock(startBlock)\n        images.forEach(image => {\n          this.$editor.addBlockAt(index, image)\n          index++\n        })\n      }\n      this.$editor.isOperating = false\n      this.$tool.isShow = false\n    }\n  }\n}\n","import createGUID from '../../utils/createGUID'\n\nexport default {\n  name: 'editor-tool-video',\n  inject: ['$editor', '$tool'],\n  render (h) {\n    const input = h('input', {\n      attrs: {\n        type: 'file',\n        accept: 'video/mp4'\n      },\n      style: {\n        display: 'none'\n      },\n      on: {\n        change: this.onChange\n      }\n    })\n    return h('label', {\n      class: ['editor-tool-btn', 'editor-tool-video'],\n      attrs: { tabindex: 0 }\n    }, [input])\n  },\n  methods: {\n    onChange (e) {\n      let files = e.target.files\n      if (!files.length) return\n      const { startBlock } = this.$editor.selection\n      if (!startBlock) return\n      const isChangeVideo = startBlock.type === 'image'\n      const file = Array.from(files)[0]\n      const video = {\n        type: 'video',\n        id: isChangeVideo ? startBlock.id : createGUID(),\n        key: 0,\n        src: URL.createObjectURL(file),\n        poster: '',\n        name: file.name,\n        text: '',\n        width: 0,\n        height: 0\n      }\n      if (isChangeVideo) {\n        for (let key in video) startBlock[key] = video[key]\n      } else {\n        let index = this.$editor.value.blocks.indexOf(startBlock)\n        this.$editor.removeBlock(startBlock)\n        this.$editor.addBlockAt(index, video)\n      }\n      this.$editor.isOperating = false\n      this.$tool.isShow = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-divider',\n  mixins: [toolItemMixin],\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('divider')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import toolItemMixin from './toolItemMixin'\n\nexport default {\n  name: 'editor-tool-blockcode',\n  mixins: [toolItemMixin],\n  watch: {\n    '$editor.selection.blockStyle' (style) {\n      this.isActive = style && style === 'blockcode'\n    }\n  },\n  methods: {\n    onClick () {\n      this.$editor.toggleBlockType('blockcode')\n      this.$editor.isOperating = false\n    }\n  }\n}\n","import Bold from './items/bold'\nimport Italic from './items/italic'\nimport Link from './items/link'\nimport Code from './items/code'\nimport Hilight from './items/hilight'\nimport Strikethrough from './items/strikethrough'\nimport Blockquote from './items/blockquote'\nimport Unorderlist from './items/unorderlist'\nimport Orderlist from './items/orderlist'\nimport Todolist from './items/todolist'\nimport Heading1 from './items/heading1'\nimport Heading2 from './items/heading2'\nimport Delete from './items/delete'\nimport Image from './items/image'\nimport Video from './items/video'\nimport Divider from './items/divider'\nimport Blockcode from './items/blockcode'\n\nconst toolMap = {\n  'bold': Bold,\n  'italic': Italic,\n  'link': Link,\n  'code': Code,\n  'hilight': Hilight,\n  'strikethrough': Strikethrough,\n  'blockquote': Blockquote,\n  'orderlist': Orderlist,\n  'unorderlist': Unorderlist,\n  'todolist': Todolist,\n  'heading1': Heading1,\n  'heading2': Heading2,\n  'delete': Delete,\n  'hr': 'hr',\n  'image': Image,\n  'video': Video,\n  'divider': Divider,\n  'blockcode': Blockcode\n}\n\nconst common = ['bold', 'italic', 'strikethrough', 'link', 'code', 'hilight', 'hr', 'heading1', 'heading2', 'blockquote', 'unorderlist']\nconst toolItems = {\n  paragraph: common,\n  heading1: common,\n  heading2: common,\n  heading3: common,\n  heading4: common,\n  blockquote: common,\n  orderlist: common,\n  unorderlist: common,\n  todolist: common,\n  blockcode: ['bolc', 'italic', 'strikethrough', 'link', 'hilight', 'hr', 'heading1', 'heading2', 'blockquote', 'unorderlist'],\n  imagetext: ['bolc', 'italic', 'strikethrough', 'link', 'hilight'],\n  image: ['image', 'hr', 'delete'],\n  divider: ['delete'],\n  video: ['video', 'hr', 'delete']\n}\n\nexport default { toolMap, toolItems }\n","import toolMaps from './popup-tool-map'\nconst { toolMap, toolItems } = toolMaps\n// console.log(toolMap, toolItems)\n\nexport default {\n  name: 'editor-tool-popup',\n  inject: ['$editor'],\n  data () {\n    return {\n      isShow: false,\n      // focusBlockType: 'paragraph',\n      position: {},\n      items: []\n    }\n  },\n  provide () {\n    return {\n      $tool: this\n    }\n  },\n  render (h) {\n    const { items, position } = this\n    const { x, y, arrowX } = position\n    // const { rangeRect } = this.$editor.selection\n    // console.log(x, y, arrowX)\n    const children = items.map(item => {\n      return h(toolMap[item])\n    })\n    children.push(h('i', {\n      class: 'editor-tool-popup-arrow',\n      style: { left: arrowX + '%' }\n    }))\n    return h('div', {\n      class: ['editor-tool-popup', '', this.isShow ? 'editor-tool-popup-show' : ''],\n      style: { left: x + 'px', top: y + 'px' },\n      on: { mousedown: this.onMousedown },\n      key: 1\n    }, children)\n  },\n  watch: {\n    '$editor.isSelecting' (isSelecting) {\n      this.isShow = !isSelecting && this.$editor.selection.rangeRect\n      if (this.isShow) this.$nextTick(this.getPosition)\n    },\n    '$editor.selection.rangeRect' (val) {\n      this.isShow = !this.$editor.isSelecting && val\n      if (this.isShow) this.$nextTick(this.getPosition)\n      else this.position = { x: 0, y: 0, arrowX: 50 }\n    },\n    '$editor.selection.blockStyle' (style) {\n      this.items = toolItems[style || 'paragraph']\n    }\n  },\n  methods: {\n    getPosition () {\n      const { rangeRect } = this.$editor.selection\n      if (!rangeRect || !this.$el) {\n        this.position = { x: 0, y: 0, arrowX: 50 }\n        return\n      }\n      const PADDING = 0\n      const { clientWidth, clientHeight } = this.$el\n      const innerWidth = this.$el.parentNode.clientWidth\n      const { left, top, width } = rangeRect\n      let x = ~~(left + (width - clientWidth) / 2)\n      let y = ~~(top - clientHeight - 10)\n      let arrowX = 50\n      if (x < PADDING) x = PADDING\n      if (x + clientWidth + PADDING > innerWidth) x = innerWidth - clientWidth - PADDING\n      arrowX = (left - x + width / 2) / clientWidth * 100\n      this.position = { x, y, arrowX }\n    },\n    onMousedown (e) {\n      this.$editor.isOperating = true\n    },\n    close (e) {\n      this.$editor.isOperating = false\n      this.$editor.selection.rangeRect = null\n    }\n  }\n}\n","export default {\n  inject: ['$editor'],\n  props: {\n    readonly: Boolean,\n    value: {\n      type: Object,\n      default: () => ({})\n    }\n  }\n}\n","import { spanMap } from '../map'\n// import * as snabbdom from 'snabbdom'\n\nfunction createLinkNode (h, context, child) {\n  return h('a', {\n    attrs: {\n      href: child._href,\n      target: 'blank',\n      'data-tip': child._href\n    },\n    on: context.readonly ? null : {\n      click: e => {\n        if (e.ctrlKey || e.metaKey) window.open(child._href)\n      }\n    }\n  }, [child])\n}\n\n/**\n *  inline \n * @param {function} h vue createElement \n * @param {function} createTextNode vue._v ,\n * @param {string} text \n * @param {array} ranges \n * @returns {array} vnodes\n */\nexport default function (h, context, text, ranges) {\n  // console.log('text render')\n  const length = text.length\n  const inlines = []\n  const createTextNode = context._v\n  if (!ranges || !ranges.length) return [createTextNode(text)]\n  // \n  let points = new Set()\n  ranges.forEach(range => {\n    const start = range.offset\n    const end = range.offset + range.length\n    points.add(start < 0 ? 0 : start)\n    points.add(end < 0 ? 0 : end)\n  })\n  points.add(0)\n  points.add(length + 1)\n  points = Array.from(points).sort((a, b) => a - b)\n\n  points.forEach((start, i) => {\n    const end = points[i + 1]\n    if (!end) return\n    const styles = new Set()\n    let href = ''\n    // \n    ranges.forEach((range) => {\n      if (start >= range.offset && end <= range.offset + range.length) {\n        styles.add(range.style)\n        if (range.style === 'link') href = range.href\n      }\n    })\n    const innerText = text.slice(start, end)\n    if (!innerText) return\n    // \n    let el = createTextNode(innerText)\n    styles.forEach(style => {\n      const tagName = spanMap[style] || 'span'\n      if (style !== 'link' && tagName) el = h(tagName, [el])\n    })\n    if (styles.has('link')) el._href = href\n    inlines.push(el)\n  })\n\n  const children = new Set()\n  // \n  let linkNode = null\n  inlines.forEach(item => {\n    if (!item._href) {\n      children.add(item)\n      linkNode = null\n    } else if (!linkNode) {\n      linkNode = createLinkNode(h, context, item)\n    } else if (item._href === linkNode.children[0]._href) {\n      linkNode.children.push(item)\n    } else {\n      linkNode = createLinkNode(h, context, item)\n    }\n\n    if (linkNode) children.add(linkNode)\n  })\n  return Array.from(children)\n}\n","import blockMixin from '../block-mixin'\nimport renderText from '../../text/text-render'\n\nexport default {\n  name: 'editor-block-heading',\n  mixins: [blockMixin],\n  render (h) {\n    let { text, ranges, key, level } = this.value\n    const tagName = 'h' + (level || 1)\n    return h('div', {\n      key,\n      attrs: { id: `user-content-${text}` }\n    }, [\n      h(tagName, renderText(h, this, text, ranges))\n    ])\n  }\n}\n","// import createBlockTextElement from '../create-block-text-element'\nimport blockMixin from '../block-mixin'\nimport renderText from '../../text/text-render'\n\nexport default {\n  name: 'editor-block-paragraph',\n  mixins: [blockMixin],\n  render (h) {\n    let { text, ranges, key } = this.value\n    return h('div', {\n      key,\n      class: text.length ? '' : 'editor-block-paragraph-empty'\n    }, [\n      h('p', renderText(h, this, text, ranges))\n    ])\n  }\n}\n","import blockMixin from '../block-mixin'\nimport renderText from '../../text/text-render'\n\nexport default {\n  name: 'editor-block-blockquote',\n  mixins: [blockMixin],\n  render (h) {\n    let { text, ranges, key } = this.value\n    return h('div', { key }, [\n      h('blockquote', renderText(h, this, text, ranges))\n    ])\n  }\n}\n","import blockMixin from '../block-mixin'\nexport default {\n  name: 'editor-block-divider',\n  mixins: [blockMixin],\n  data () {\n    return {\n      isSelected: false\n    }\n  },\n  watch: {\n    '$editor.selection.blocks' (blocks) {\n      this.isSelected = (blocks && blocks.includes(this.value))\n    }\n  },\n  render (h) {\n    return h('hr', this.readonly ? {} : {\n      class: this.isSelected ? 'editor-block-selected' : '',\n      attrs: { tabindex: 0 }\n    })\n  }\n}\n","import renderText from '../../text/text-render'\n// import TextEditor from '../../text/text-editor'\nimport blockMxin from '../block-mixin'\n\nexport default {\n  name: 'editor-list-item',\n  mixins: [blockMxin],\n  render (h) {\n    const { text, ranges, key } = this.value\n    return h('li', { key }, renderText(h, this, text, ranges))\n  }\n}\n","export default {\n  name: 'editor-checkbox',\n  props: {\n    checked: Boolean,\n    disabled: Boolean\n  },\n  render (h) {\n    return h('label', {\n      class: [\n        'editor-checkbox',\n        this.checked ? 'editor-checkbox-checked' : '',\n        this.disabled ? 'editor-checkbox-disabled' : ''\n      ],\n      attrs: {\n        'data-skip-check': 1,\n        contenteditable: false\n      },\n      on: {\n        change: this.onChange\n      }\n    }, [\n      h('input', {\n        attrs: {\n          type: 'checkbox',\n          'data-skip-check': 1,\n          checked: this.checked,\n          disabled: this.disabled\n        }\n      })\n    ])\n  },\n  methods: {\n    onChange (e) {\n      e.stopPropagation()\n      this.$emit('change', e.target.checked)\n      console.log('on change', e.target.checked)\n    }\n  }\n}\n","import renderText from '../../text/text-render'\nimport Checkbox from './checkbox'\nimport blockMixin from '../block-mixin'\n\nexport default {\n  name: 'editor-todo-item',\n  mixins: [blockMixin],\n  render (h) {\n    const { readonly, value } = this\n    const { text, ranges, key, checked } = value\n    const texts = h('div', {\n      class: 'editor-todo-content'\n    }, renderText(h, this, text, ranges))\n    const checkbox = h(Checkbox, {\n      props: { disabled: readonly, checked },\n      on: {\n        change: e => { value.checked = e }\n      }\n    })\n    return h('li', {\n      class: checked ? 'editor-todo-checked' : '',\n      on: Object.assign({}, this.$listeners, {}),\n      key\n    }, [checkbox, texts])\n  }\n}\n","import blockMixin from '../block-mixin'\nexport default {\n  name: 'editor-block-image',\n  mixins: [blockMixin],\n  data () {\n    return {\n      isSelected: false\n    }\n  },\n  watch: {\n    '$editor.selection.blocks' (blocks) {\n      this.isSelected = (blocks && blocks.includes(this.value))\n    }\n  },\n  render (h) {\n    const { readonly, value } = this\n    const { src, alt, text, width, height } = value\n    const img = h('img', {\n      attrs: { src, alt, width, height, draggable: readonly },\n      on: {\n        load: e => {\n          value.width = e.target.naturalWidth\n          value.height = e.target.naturalHeight\n        }\n      }\n    })\n    const descClass = 'editor-block-desc'\n    let desc\n    if (readonly) {\n      desc = h('figcaption', { class: descClass }, [text])\n    } else {\n      desc = h('input', {\n        class: descClass,\n        attrs: {\n          type: 'text',\n          value: text,\n          placeholder: ''\n        },\n        on: {\n          input: e => { value.text = e.target.value },\n          paste: e => { e.stopPropagation() },\n          selectionchange: e => { e.stopPropagation() },\n          keydown: e => { e.stopPropagation() }\n        }\n      })\n    }\n\n    return h('figure', {\n      class: this.isSelected ? 'editor-block-selected' : '',\n      attrs: { tabindex: readonly ? null : 1, contenteditable: false },\n      style: { flex: 100 / height * width }\n    }, [img, desc])\n  }\n}\n","import Image from './image'\n\nexport default {\n  name: 'editor-block-images',\n  inject: ['$editor'],\n  props: {\n    readonly: Boolean,\n    value: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  render (h) {\n    const { value, readonly } = this\n\n    const children = value.images.map(item => {\n      const width = 100 / item.height * item.width\n      return h(Image, {\n        props: { readonly, value: item, width }\n      })\n    })\n\n    return h('div', {}, children)\n  }\n}\n","import renderText from '../../text/text-render'\nimport blockMxin from '../block-mixin'\n\nexport default {\n  name: 'editor-blockcode-line',\n  mixins: [blockMxin],\n  render (h) {\n    const { text, ranges, key } = this.value\n    return h('div', { key }, renderText(h, this, text, ranges))\n  }\n}\n","import blockMixin from '../block-mixin'\nexport default {\n  name: 'editor-block-video',\n  mixins: [blockMixin],\n  data () {\n    return {\n      isSelected: false\n    }\n  },\n  watch: {\n    '$editor.selection.blocks' (blocks) {\n      this.isSelected = (blocks && blocks.includes(this.value))\n    }\n  },\n  render (h) {\n    const { readonly, value } = this\n    const { src, text, poster, width, height } = value\n    const video = h('video', {\n      attrs: {\n        src,\n        controls: true,\n        poster,\n        width,\n        height\n      },\n      on: {\n        loadedmetadata: e => {\n          const v = e.target\n          if (v.readyState > 0) {\n            value.width = v.videoWidth\n            value.height = v.videoHeight\n          }\n        }\n      }\n    })\n    const descClass = 'editor-block-desc'\n    let desc\n    if (readonly) {\n      desc = h('figcaption', { class: descClass }, [text])\n    } else {\n      desc = h('input', {\n        class: descClass,\n        attrs: {\n          type: 'text',\n          value: text,\n          placeholder: ''\n        },\n        on: {\n          input: e => { value.text = e.target.value },\n          paste: e => { e.stopPropagation() },\n          selectionchange: e => { e.stopPropagation() }\n        }\n      })\n    }\n    return h('div', {\n      class: [this.isSelected ? 'editor-block-selected' : ''],\n      attrs: { tabindex: readonly ? null : 1, contenteditable: false }\n    }, [video, desc])\n  }\n}\n","import Heading from './blocks/heading/heading'\nimport Paragraph from './blocks/paragraph/paragraph'\nimport Blockquote from './blocks/blockquote/blockquote'\nimport Divider from './blocks/divider/divider'\nimport Listitem from './blocks/lists/listitem'\nimport Todoitem from './blocks/lists/todoitem'\nimport Images from './blocks/image/images'\nimport Image from './blocks/image/image'\nimport Blockcode from './blocks/blockcode/blockcode'\nimport Video from './blocks/video/video'\n// import Orderlist from './blocks/lists/orderlist'\n// import Unorderlist from './blocks/lists/unorderlist'\n// import Todolist from './blocks/lists/todolist'\n\nconst spanMap = {\n  bold: 'strong',\n  italic: 'em',\n  link: 'a',\n  underline: 'ins',\n  strikethrough: 'del',\n  hilight: 'mark',\n  code: 'code'\n}\n\nconst blockMap = {\n  heading: Heading,\n  paragraph: Paragraph,\n  blockquote: Blockquote,\n  divider: Divider,\n  orderlist: Listitem,\n  unorderlist: Listitem,\n  todolist: Todoitem,\n  images: Images,\n  image: Image,\n  blockcode: Blockcode,\n  video: Video\n}\n\nconst textBlockMap = {\n  heading: Heading,\n  paragraph: Paragraph,\n  blockquote: Blockquote,\n  orderlist: Listitem,\n  unorderlist: Listitem,\n  todolist: Todoitem,\n  blockcode: Blockcode\n}\n\nconst listTypes = {\n  orderlist: 'ol',\n  unorderlist: 'ul',\n  todolist: 'ul',\n  blockcode: 'code',\n  image: 'div'\n}\n\nexport { spanMap, blockMap, listTypes, textBlockMap }\n","\nimport { textBlockMap } from '../map'\nimport createGUID from '../utils/createGUID'\n\nexport function isTextBlock (block) {\n  if (!block) return false\n  return !!textBlockMap[block.type]\n}\n\nexport function getBlockNodeByChildNode (node) {\n  if (!node) return null\n  if (node.dataset && node.dataset.id) return node\n  return getBlockNodeByChildNode(node.parentNode)\n}\n\nexport function getNodeById (id) {\n  return document.querySelector(`[data-id=\"${id}\"]`)\n}\n\nexport function getBlockById (blocks, id) {\n  if (!blocks || !blocks.length || !id) return null\n  return blocks.filter(item => item.id === id)[0] || null\n}\n\nexport function getSelectedBlocks (blocks, startId, endId) {\n  const result = new Set()\n  let go = false\n  blocks.forEach(item => {\n    if (item.id === startId) {\n      result.add(item)\n      go = true\n    }\n    if (item.id === endId) {\n      result.add(item)\n      go = false\n    }\n    if (go) result.add(item)\n  })\n  return Array.from(result)\n}\n//  range \nexport function getRangeRect (range, el) {\n  if (!el || !range) return null\n  const rangeRect = range.getBoundingClientRect()\n  const elRect = el.getBoundingClientRect()\n  return {\n    left: rangeRect.left - elRect.left,\n    top: rangeRect.top - elRect.top,\n    width: rangeRect.width,\n    height: rangeRect.height\n  }\n}\n//  node  offset  root  offset \nexport function getOffset (root, node, _offset) {\n  let offset = _offset\n  if (root === node) return _offset\n  //  node  root \n  function getRootChildNode (_root, _node) {\n    if (!_node) return null\n    return _node.parentNode === _root ? _node : getRootChildNode(_root, _node.parentNode)\n  }\n  const rootChildNode = getRootChildNode(root, node)\n  if (!rootChildNode) return null\n  if (rootChildNode.childNodes && rootChildNode.childNodes.length) {\n    offset = getOffset(rootChildNode, node, _offset)\n  }\n  const nodes = root.childNodes\n  const len = nodes.length\n  for (let i = 0; i < len; i++) {\n    const item = nodes[i]\n    if (item === rootChildNode) break\n    else if (item.nodeType === 3) offset += item.length\n    else offset += item.innerText.length\n  }\n  return offset\n}\n//   start ~ end \nexport function getRangeStyles (ranges, start, end) {\n  const styles = {}\n  if (!ranges) return styles\n  ranges.forEach(item => {\n    const itemEnd = item.offset + item.length\n    //  range offset \n    const isAtStart = end - start <= 0 && start === item.offset\n\n    if (!isAtStart && start >= item.offset && end <= itemEnd) {\n      const style = item.style\n      styles[style] = 1\n    }\n  })\n  return styles\n}\n//  range\nexport function mergeRanges (ranges) {\n  if (!ranges) return\n  if (ranges.length < 2) return\n  function each (arr) {\n    let go = false // \n    arr.forEach((item1, i) => {\n      arr.forEach((item2, j) => {\n        if (item1 === item2) return\n        if (item1.style !== item2.style) return\n        if (item1.style === 'link' && item1.href !== item2.href) return\n        let s1 = item1.offset\n        let e1 = item1.offset + item1.length\n        let s2 = item2.offset\n        let e2 = item2.offset + item2.length\n        if (s2 >= s1 && s2 <= e1) {\n          go = true\n          arr.splice(j, 1)\n          item1.offset = Math.min(s1, s2)\n          item1.length = Math.max(e1, e2) - item1.offset\n        }\n      })\n    })\n    if (go) each(ranges)\n  }\n  each(ranges)\n}\n//  range\n// function filterRanges (ranges, maxOffset) {\n//   ranges.forEach((item, i) => {\n//     if (\n//       item.offset < 0 ||\n//       item.length <= 0 ||\n//       !item.style ||\n//       item.offset >= maxOffset\n//     ) {\n//       ranges.splice(i, 1)\n//     }\n//   })\n// }\n//  range\nexport function splitRange (baseRange, cutRange) {\n  const { style } = baseRange\n  let points = [\n    baseRange.offset,\n    baseRange.offset + baseRange.length,\n    cutRange.offset,\n    cutRange.offset + cutRange.length\n  ].sort((a, b) => a - b)\n  return [\n    { offset: points[0], length: points[1] - points[0], style },\n    { offset: points[2], length: points[3] - points[2], style }\n  ].filter(item => item.offset >= 0 && item.length > 0)\n}\n//  offset \nexport function getFocusNodeAndOffset (root, offset) {\n  let i = 0\n  function getResult (_root, _offset) {\n    i += 1\n    let len = 0\n    let focusNode = _root\n    let focusOffset = 0\n    if (!_root) return { focusNode, focusOffset }\n    const nodes = _root.childNodes\n    const length = nodes.length\n    for (let i = 0; i < length; i++) {\n      const item = nodes[i]\n      if (!item.dataset || !item.dataset.skipCheck) { //  data-skip-check\n        //  item  Element, TextNode\n        let itemLength = item.length\n        if (!(itemLength >= 0)) itemLength = item.innerText ? item.innerText.length : 0\n        len += itemLength\n        if (len >= _offset) {\n          focusNode = item\n          focusOffset = itemLength - (len - _offset)\n          break\n        } else if (i === length - 1) {\n          focusNode = item\n          focusOffset = len\n        }\n      }\n    }\n    if (focusNode.nodeType === 3) {\n      i = 0\n      return { focusNode, focusOffset }\n    }\n    if (i > 1000) {\n      i = 0\n      return { focusNode, focusOffset }\n    }\n    return getResult(focusNode, focusOffset)\n  }\n  return getResult(root, offset)\n}\n//  range  length  ranges\nexport function replaceRange (ranges, range, inputLength) {\n  // console.log(JSON.parse(JSON.stringify(range)), inputLength)\n  const rangeStart = range.offset\n  const rangeEnd = range.offset + range.length\n  const changeLength = inputLength - range.length\n  // console.log('change lenght', changeLength, inputLength)\n  ranges.forEach((item, i) => {\n    let itemStart = item.offset\n    let itemEnd = item.offset + item.length\n    // \n    if (rangeStart >= itemEnd) {\n      // console.log(1)\n      return\n    }\n    //  offset \n    if (rangeEnd <= itemStart) {\n      // console.log(2)\n      item.offset += changeLength\n      return\n    }\n    // \n    if (rangeStart <= itemStart && rangeEnd >= itemEnd) {\n      // console.log(3)\n      item.offset = item.length = 0\n      return\n    }\n    //  length \n    if (rangeStart >= itemStart && rangeEnd <= itemEnd) {\n      // console.log(4)\n      item.length += changeLength\n      return\n    }\n    // \n    if (rangeStart < itemStart && rangeEnd > itemStart) {\n      // console.log(5)\n      item.offset = rangeStart + inputLength\n      item.length -= rangeEnd - itemStart\n      return\n    }\n    // \n    if (rangeStart < itemEnd && rangeEnd > itemEnd) {\n      // console.log(6)\n      item.length -= itemEnd - rangeStart\n    }\n  })\n}\n//  range  block   block\nexport function splitBlock (block, range) {\n  if (!isTextBlock(block)) return null\n  const rangeStart = range.offset\n  const rangeEnd = range.offset + range.length\n  const text1 = block.text.slice(0, rangeStart)\n  const text2 = block.text.slice(rangeEnd, block.text.length)\n  const ranges1 = []\n  const ranges2 = []\n  block.ranges.forEach(item => {\n    const itemStart = item.offset\n    const itemEnd = item.offset + item.length\n    if (itemEnd <= rangeStart) {\n      ranges1.push(item)\n      return\n    }\n    if (itemStart >= rangeEnd) {\n      item.offset -= rangeEnd\n      ranges2.push(item)\n      return\n    }\n    if (itemStart > rangeStart && itemEnd < rangeEnd) {\n      return\n    }\n    if (rangeStart > itemStart && rangeEnd < itemEnd) {\n      item.length = rangeStart - itemStart\n      ranges1.push(item)\n      const newRange = {\n        offset: 0,\n        length: itemEnd - rangeEnd,\n        style: item.style\n      }\n      for (let key in item) if (newRange[key] === undefined) newRange[key] = item[key]\n      ranges2.push(newRange)\n      return\n    }\n    if (itemStart > rangeStart && itemStart < rangeEnd) {\n      item.offset = 0\n      item.length = itemEnd - rangeEnd\n      ranges2.push(item)\n      return\n    }\n    if (itemEnd > rangeStart && itemEnd < rangeEnd) {\n      item.length = rangeStart - itemStart\n      ranges1.push(item)\n    }\n  })\n  block.text = text1\n  block.ranges = ranges1\n  const result = {\n    id: createGUID(),\n    key: 0,\n    text: text2,\n    ranges: ranges2\n  }\n  return result\n}\n//  block\nexport function mergeBlocks (block1, block2) {\n  if (!isTextBlock(block1) || !isTextBlock(block2)) return\n  block2.ranges.forEach(item => {\n    item.offset += block1.text.length\n  })\n  block1.ranges = block1.ranges.concat(block2.ranges)\n  block1.text += block2.text\n}\n","import { getNodeById, getRangeRect } from '../utils/editor-util'\nimport toolMaps from './popup-tool-map'\nconst { toolMap } = toolMaps\n\nconst items = ['heading1', 'heading2', 'blockquote', 'unorderlist', 'orderlist', 'todolist', 'hr',\n  'image', 'video', 'divider', 'blockcode']\n\nexport default {\n  name: 'editor-tool-add',\n  inject: ['$editor'],\n  provide () {\n    return {\n      $tool: this\n    }\n  },\n  data () {\n    return {\n      isShow: false,\n      isOpen: false,\n      position: {}\n    }\n  },\n  watch: {\n    '$editor.selection.startBlock' (startBlock) {\n      const endBlock = this.$editor.selection.endBlock\n      this.isShow = (startBlock && startBlock === endBlock && startBlock.type === 'paragraph' && !startBlock.text.length)\n      if (this.isShow) this.$nextTick(this.getPosition)\n      else this.isOpen = false\n    }\n  },\n  render (h) {\n    const { isShow, isOpen, position } = this\n    const { x, y } = position\n    const addBtn = h('button', {\n      class: ['editor-tool-btn', 'editor-tool-add-btn'],\n      attrs: { 'data-tip': 'Add: | tab' },\n      on: {\n        click: e => { this.isOpen = !this.isOpen }\n      }\n    })\n\n    const btns = items.map(item => h(toolMap[item]))\n\n    const btnsContainer = h('div', {\n      class: 'editor-tool-add-btns',\n      on: { mousedown: this.onMousedown }\n    }, btns)\n\n    return h('div', {\n      class: [\n        'editor-tool-add',\n        isShow ? 'editor-tool-add-show' : '',\n        isOpen ? 'editor-tool-add-open' : ''\n      ],\n      style: { left: x + 'px', top: y + 'px' },\n      on: {\n        keydown: this.onKeydown\n      }\n    }, [addBtn, btnsContainer])\n  },\n  methods: {\n    getPosition () {\n      const { startBlock } = this.$editor.selection\n      const node = getNodeById(startBlock.id)\n      if (!node) {\n        this.position = { x: 0, y: 0 }\n        return\n      }\n      const nodeHeight = node.clientHeight\n      const { clientHeight } = this.$el\n      const rect = getRangeRect(node, this.$editor.$el)\n      // console.log(rect)\n      this.position = {\n        x: rect.left + 5,\n        y: rect.top + (nodeHeight - clientHeight) / 2\n      }\n      // console.log(this.position.x, this.position.y)\n    },\n    onMousedown (e) {\n      this.$editor.isOperating = true\n    },\n    onKeydown (e) {\n      switch (e.keyCode) {\n        case 27:\n          this.isOpen = false\n          this.$editor.restoreSelection()\n          break\n        case 9:\n          this.isOpen = true\n          break\n      }\n    }\n  }\n}\n","import { getRangeRect } from '../utils/editor-util'\n\nexport default {\n  name: 'editor-tool-tip',\n  data () {\n    return {\n      isShow: false,\n      isEnter: false,\n      content: '',\n      target: null,\n      x: 0,\n      y: 0,\n      arrowX: 50,\n      timer: null\n    }\n  },\n  render (h) {\n    const { isShow, content, x, y, arrowX } = this\n    const arrow = h('i', {\n      class: 'editor-tool-tip-arrow',\n      style: { left: arrowX + '%' }\n    })\n    return h('div', {\n      class: ['editor-tool-tip', isShow ? 'editor-tool-tip-show' : ''],\n      style: { left: x + 'px', top: y + 'px' }\n    }, [content, arrow])\n  },\n  mounted () {\n    this.addListeners()\n  },\n  methods: {\n    addListeners () {\n      const editorEl = this.$el.parentNode\n      editorEl.addEventListener('mouseenter', this.onMouseenter, true)\n      editorEl.addEventListener('mouseleave', this.onMouseleave, true)\n      this.$once('hook:beforeDestroy', () => {\n        editorEl.removeEventListener('mouseenter', this.onMouseenter, true)\n        editorEl.removeEventListener('mouseleave', this.onMouseleave, true)\n      })\n    },\n    onMouseenter (e) {\n      const el = e.target\n      if (!el.dataset.tip || this.isEnter) return\n      this.target = el\n      this.isEnter = true\n      this.timer = setTimeout(() => {\n        if (this.isEnter) {\n          this.content = this.target.dataset.tip\n          this.isShow = true\n          this.$nextTick(this.getPosition)\n        }\n      }, 500)\n    },\n    onMouseleave (e) {\n      const el = e.target\n      if (!el.dataset.tip) return\n      clearTimeout(this.timer)\n      this.isEnter = false\n      this.content = ''\n      this.isShow = false\n    },\n    getPosition () {\n      const { target } = this\n      const { clientWidth } = this.$el\n      const editorEl = this.$el.parentNode\n      const rect = getRangeRect(target, editorEl)\n      const { left, top, width, height } = rect\n      let x = ~~(left + (width - clientWidth) / 2)\n      let y = ~~(top + height + 10)\n      let arrowX = 50\n      if (x < 0) x = 0\n      if (x + clientWidth > innerWidth) x = innerWidth - clientWidth\n      arrowX = (left - x + width / 2) / clientWidth * 100\n      this.x = x\n      this.y = y\n      this.arrowX = arrowX\n      // const\n    }\n  }\n}\n","import { blockMap, listTypes } from '../map'\n// import BlockContainer from './block-container'\n\nfunction renderBlocks (h, blocks, readonly) {\n  let children = []\n  let list = []\n  blocks.forEach((item, i) => {\n    const type = item.type || 'paragraph'\n    const component = blockMap[type] || blockMap.paragraph\n    const dataindex = listTypes[type] ? list.length + 1 : null\n    const child = h(component, {\n      props: { value: item, readonly },\n      attrs: {\n        'data-index': dataindex,\n        'data-index-num': dataindex ? dataindex + '.' : null,\n        'data-id': item.id\n      },\n      class: dataindex ? `editor-list-item` : ['editor-block', 'editor-block-' + type],\n      key: item.id,\n      on: {}\n    })\n\n    if (!listTypes[type]) {\n      children.push(child)\n      return\n    }\n    //  list\n    list.push(child)\n    const next = blocks[i + 1]\n    if (!next || next.type !== item.type || next.row !== item.row) {\n      const listNode = h(listTypes[type], {\n        class: ['editor-list', 'editor-list-' + type]\n      }, list)\n      children.push(\n        h('div', {\n          class: ['editor-block', 'editor-block-' + type]\n        }, [listNode])\n      )\n      list = []\n    }\n  })\n  return children\n}\n\nexport default renderBlocks\n","import createGUID from './createGUID'\n\nexport default function formatValue (context, value) {\n  if (!value) value = {}\n  if (!value.blocks || !(value.blocks instanceof Array)) value.blocks = []\n  if (!value.blocks.length) {\n    value.blocks.push({\n      type: 'paragraph',\n      id: createGUID(),\n      text: '',\n      ranges: []\n    })\n  }\n  value.blocks.forEach(item => {\n    context.$set(item, 'id', item.id || createGUID()) // id\n    context.$set(item, 'key', 0)\n    if (item.blocks && item.blocks.length) formatValue(item)\n  })\n}\n","export default [\n  function (block, context) {\n    if (!block.text || block.type === 'blockquote') return false\n    const reg = /^>\\s/\n    const match = block.text.match(reg)\n    if (match) {\n      block.type = 'blockquote'\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= 2 })\n      return true\n    }\n  },\n  function (block, context) {\n    if (!block.text) return false\n    const reg = /^#+\\s/\n    const match = block.text.match(reg)\n    if (match) {\n      block.type = 'heading'\n      const level = match[0].length - 1\n      block.level = level > 4 ? 4 : level\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= match[0].length })\n      return true\n    }\n  },\n  function (block, context) {\n    if (!block.text || block.type === 'unorderlist') return false\n    const reg = /^(\\*|-|\\+)\\s/\n    const match = block.text.match(reg)\n    if (match) {\n      block.type = 'unorderlist'\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= 2 })\n      return true\n    }\n  },\n  function (block, context) {\n    if (!block.text || block.type === 'orderlist') return false\n    const reg = /^\\d\\.\\s/\n    const match = block.text.match(reg)\n    if (match) {\n      block.type = 'orderlist'\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= 3 })\n      return true\n    }\n  },\n  function (block, context) {\n    if (!block.text || block.type === 'todolist') return false\n    const reg = /^\\[(\\s|x)?\\]\\s/\n    const match = block.text.match(reg)\n    if (match) {\n      block.type = 'todolist'\n      context.$set(block, 'checked', !!match[0].match('x'))\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= 3 })\n      return true\n    }\n  },\n  function (block) {\n    if (!block.text) return false\n    const reg = /^-{3,10}$/\n    if (block.text.match(reg)) {\n      block.type = 'divider'\n      block.text = ''\n      return true\n    }\n  },\n  function (block) {\n    if (!block.text || block.type === 'blockcode') return false\n    const reg = /^`{3}/\n    if (block.text.match(reg)) {\n      block.type = 'blockcode'\n      block.text = block.text.replace(reg, '')\n      block.ranges.forEach(item => { item.offset -= 3 })\n      return true\n    }\n  }\n]\n","import ToolPopup from './tool/popup-tool'\nimport ToolAdd from './tool/add-tool'\nimport ToolTip from './tool/tool-tip'\nimport renderBlocks from './blocks/block-render'\nimport formatValue from './utils/formatValue'\nimport createGUID from './utils/createGUID'\nimport debounce from 'debounce'\nimport { listTypes } from './map'\nimport formatters from './formatters'\nimport {\n  isTextBlock,\n  getBlockNodeByChildNode,\n  getNodeById,\n  getBlockById,\n  getSelectedBlocks,\n  getRangeRect,\n  getOffset,\n  getRangeStyles,\n  mergeRanges,\n  splitRange,\n  getFocusNodeAndOffset,\n  replaceRange,\n  splitBlock,\n  mergeBlocks\n} from './utils/editor-util'\n\nexport default {\n  name: 'editor',\n  props: {\n    readonly: Boolean,\n    // image\n    value: {\n      type: Object,\n      default: () => ({})\n    }\n  },\n  data () {\n    formatValue(this, this.value)\n    return {\n      isComposing: false,\n      isOperating: false,\n      isSelecting: false,\n      isHistoryBacking: false,\n      isFocus: false,\n      key: 0, //  article \n\n      selection: {\n        startOffset: null, //  block  offset\n        endOffset: null, //  block  offset\n        startBlock: null,\n        endBlock: null,\n        rangeRect: null, // \n        blocks: null, //  block value\n        blockStyle: null, //  block \n        inlineStyles: null //  inline \n      },\n      history: {\n        index: 0,\n        list: [] // [{ selection, value }, ...]\n      }\n    }\n  },\n  provide () {\n    return {\n      $editor: this\n    }\n  },\n  render (h) {\n    const { value, readonly } = this\n    let article, toolPopup, addTool, toolTip\n\n    article = h('article', {\n      attrs: { contenteditable: !readonly },\n      on: readonly ? null : {\n        input: this.onInput,\n        paste: this.onPaste,\n        keydown: this.onKeydown,\n        mousedown: this.onMousedown,\n        compositionstart: this.onCompositionstart,\n        compositionend: this.onCompositionend,\n        drop: this.onDrop,\n        '!focus': this.onFocus\n      },\n      ref: 'article',\n      key: this.key\n    }, renderBlocks(h, value.blocks, readonly))\n\n    if (!readonly) {\n      toolPopup = h(ToolPopup, { ref: 'popupTool' })\n      addTool = h(ToolAdd, { ref: 'addTool' })\n    }\n    toolTip = h(ToolTip, { ref: 'tip' })\n\n    return h('div', {\n      class: 'editor'\n    }, [article, toolPopup, addTool, toolTip])\n  },\n  errorCaptured (err, vm, info) {\n    console.log(err, vm, info)\n  },\n  mounted () {\n    this.addListeners()\n    this.$once('hook:beforeDestroy', this.removeListeners)\n  },\n  watch: {\n    value: {\n      handler: debounce(function (val) {\n        if (this.isHistoryBacking) {\n          this.isHistoryBacking = false\n          return\n        }\n        this.historyForward()\n      }, 300),\n      deep: true\n    },\n    selection (val) {\n      if (!this.history.list.length) {\n        this.historyForward()\n        console.log('history add')\n      }\n    }\n  },\n  methods: {\n    addListeners () {\n      document.addEventListener('selectionchange', this.onSelectionchange)\n      document.addEventListener('mousedown', this.onPageMousedown)\n      document.addEventListener('mouseup', this.onPageMouseup)\n    },\n    removeListeners () {\n      document.removeEventListener('selectionchange', this.onSelectionchange)\n      document.removeEventListener('mousedown', this.onPageMousedown)\n    },\n    onPageMousedown (e) {\n      const path = e.path || (e.composedPath && e.composedPath())\n      if (!path.includes(this.$el)) {\n        for (let key in this.selection) this.selection[key] = null\n        this.isFocus = false\n      } else {\n        this.isFocus = true\n      }\n    },\n    onPageMouseup (e) {\n      this.isSelecting = false\n    },\n    onCompositionstart (e) {\n      this.isComposing = true\n    },\n    onCompositionend (e) {\n      this.isComposing = false\n      this.onInput(e)\n    },\n    onInput (e) {\n      if (this.isComposing || e.srcElement !== this.$refs.article) return\n      if (this.isHistoryBacking) return\n      // console.log('input') // input  selectionchange \n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      if (startBlock === endBlock) {\n        const oldLength = startBlock.text.length\n        const node = getNodeById(startBlock.id)\n        const newLength = node.innerText.length\n        const range = { offset: startOffset, length: endOffset - startOffset }\n        let inputLength = e.data ? e.data.length : newLength + range.length - oldLength\n        if (inputLength < 0) {\n          range.offset += inputLength\n          range.length -= inputLength\n          inputLength = 0\n        }\n        replaceRange(startBlock.ranges, range, inputLength)\n        startBlock.text = node.innerText.replace(/\\n/g, '')\n        // \n        let formated = false\n        formatters.forEach(format => {\n          const res = format(startBlock, this)\n          if (res) formated = true\n        })\n        startBlock.key++\n        if (isTextBlock(startBlock)) {\n          const newOffset = formated ? 0 : range.offset + inputLength\n          this.setSelection(startBlock, startBlock, newOffset, newOffset)\n        } else {\n          this.$nextTick(() => {\n            const node = getNodeById(startBlock.id)\n            node && node.focus()\n          })\n        }\n        return\n      }\n      this.onInputCrossBlocks()\n      startBlock.text += e.data || ''\n      mergeBlocks(startBlock, endBlock)\n      mergeRanges(startBlock.ranges)\n      this.removeBlock(endBlock)\n      this.key++\n      const newOffset = startOffset + (e.data ? e.data.length : 0)\n      this.setSelection(startBlock, startBlock, newOffset, newOffset)\n    },\n    onInputCrossBlocks () { //  block  block\n      const { startBlock, endBlock, blocks, startOffset, endOffset } = this.selection\n      blocks.forEach(item => {\n        if (!isTextBlock(item) || (item !== startBlock && item !== endBlock)) this.removeBlock(item)\n      })\n      if (isTextBlock(startBlock)) {\n        const range1 = { offset: startOffset, length: startBlock.text.length - startOffset }\n        replaceRange(startBlock.ranges, range1, 0)\n        startBlock.text = startBlock.text.substring(0, startOffset)\n      }\n      if (isTextBlock(endBlock)) {\n        const range2 = { offset: 0, length: endOffset }\n        replaceRange(endBlock.ranges, range2, 0)\n        endBlock.text = endBlock.text.substring(endOffset)\n      }\n    },\n    onPaste (e) {\n      e.preventDefault()\n      const { clipboardData } = e\n      const text = clipboardData.getData('text/plain')\n      if (!text) return\n      const arr = text.split(/\\n/).filter(item => item)\n      console.log(arr)\n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      // const startText = arr[0]\n      // const endText = arr[1]\n      if (arr.length === 1 && startBlock === endBlock) {\n        if (!isTextBlock(startBlock)) return\n        const data = arr[0]\n        const range = { offset: startOffset, length: endOffset - startOffset }\n        replaceRange(startBlock.ranges, range, data.length)\n        const t = startBlock.text\n        startBlock.text = t.substring(0, startOffset) + data + t.substring(endOffset)\n        startBlock.key++\n        const newOffset = startOffset + data.length\n        this.setSelection(startBlock, startBlock, newOffset, newOffset)\n        return\n      }\n      if (arr.length === 1) {\n\n      }\n    },\n    onDrop (e) {\n      e.preventDefault()\n    },\n    onKeydown (e) {\n      if (!this.isFocus) {\n        e.preventDefault()\n        return\n      }\n      // console.log('onkeydown')\n      const code = e.keyCode\n      // this.selection.rangeRect = null\n      const ctrl = (e.ctrlKey || e.metaKey)\n      // console.log(ctrl, code)\n      switch (code) {\n        case 8: // \n          this.onKeyBackspace(e)\n          break\n        case 9:\n          this.onKeyTab(e)\n          break\n        case 27:\n          this.onKeyEsc(e)\n          break\n        case 13: // \n          this.onKeyEnter(e)\n          break\n      }\n      // \n      if (ctrl) {\n        // console.log(e.keyCode)\n        switch (e.keyCode) {\n          case 66: // ctrl+B\n            e.preventDefault()\n            this.toggleInlineStyle('bold')\n            break\n          case 73: // ctrl+I\n            e.preventDefault()\n            this.toggleInlineStyle('italic')\n            break\n          case 85: // ctrl+U\n            e.preventDefault()\n            this.toggleInlineStyle('underline')\n            break\n          case 83: // ctrl+S\n            // e.preventDefault()\n            // console.log(e)\n            // this.exe('underline')\n            break\n          case 90: // ctrl+Z\n            this.historyBack()\n            break\n        }\n      }\n    },\n    onKeyBackspace (e) {\n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      if (!startBlock || !endBlock) return\n      const vblocks = this.value.blocks\n      if (startBlock === endBlock) {\n        const type = startBlock.type\n        const node = getNodeById(startBlock.id)\n        const prevBlock = vblocks[vblocks.indexOf(startBlock) - 1]\n        const prevBlockNode = prevBlock ? getNodeById(prevBlock.id) : null\n\n        //  startBlock \n        if (!prevBlock) {\n          if (!isTextBlock(startBlock)) return\n          if (startOffset === 0 && endOffset === 0) {\n            e.preventDefault()\n            if (type === 'paragraph') return\n            this.clearBlockType()\n            this.setSelection(startBlock, startBlock, 0, 0)\n            return\n          }\n        }\n        // \n        if (!(!startOffset && !endOffset)) return\n        e.preventDefault()\n        // \n        if (!isTextBlock(startBlock)) {\n          this.removeBlock(startBlock)\n          isTextBlock(prevBlock)\n            ? this.setSelection(prevBlock, prevBlock, prevBlock.text.length, prevBlock.text.length)\n            : prevBlockNode.focus()\n          return\n        }\n        if (type === 'paragraph' || (type === 'blockcode' && node.dataset.index !== '1')) {\n          if (!isTextBlock(prevBlock)) {\n            if (!startBlock.text.length) this.removeBlock(startBlock)\n            prevBlockNode.focus()\n            return\n          }\n          const prevTextLen = prevBlock.text.length\n          mergeBlocks(prevBlock, startBlock)\n          mergeRanges(prevBlock.ranges)\n          this.removeBlock(startBlock)\n          this.setSelection(prevBlock, prevBlock, prevTextLen, prevTextLen)\n          return\n        }\n        this.clearBlockType()\n        this.setSelection(startBlock, startBlock, 0, 0)\n        return\n      }\n      e.preventDefault()\n      this.onInputCrossBlocks()\n      mergeBlocks(startBlock, endBlock)\n      mergeRanges(startBlock.ranges)\n      this.removeBlock(endBlock)\n      this.setSelection(startBlock, startBlock, startOffset, startOffset)\n    },\n    onKeyEnter (e) {\n      e.preventDefault()\n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      if (startBlock === endBlock) {\n        if (!isTextBlock(startBlock)) {\n          const newBlock = { type: 'paragraph', id: createGUID(), key: 0, text: '', ranges: [] }\n          this.addBlockAt(this.value.blocks.indexOf(startBlock) + 1, newBlock)\n          this.setSelection(newBlock, newBlock, 0, 0)\n          return\n        }\n        const range = { offset: startOffset, length: endOffset - startOffset }\n        const newBlock = splitBlock(startBlock, range)\n        const type = startBlock.type\n        const index = this.value.blocks.indexOf(startBlock)\n\n        if (!listTypes[type]) {\n          this.addBlockAt(index + 1, newBlock)\n          this.setSelection(newBlock, newBlock, 0, 0)\n          return\n        }\n        //  block  type\n        if (startBlock.text.length || newBlock.text.length) {\n          newBlock.type = type\n          newBlock.checked = false\n          this.addBlockAt(index + 1, newBlock)\n          this.setSelection(newBlock, newBlock, 0, 0)\n        } else {\n          // \n          if (type !== 'blockcode') {\n            this.clearBlockType(startBlock)\n            this.setSelection(startBlock, startBlock, 0, 0)\n          } else {\n            const prev = this.value.blocks[this.value.blocks.indexOf(startBlock) - 1]\n            if (!prev) return\n            if (!prev.text.length) {\n              this.clearBlockType(startBlock)\n              this.setSelection(startBlock, startBlock, 0, 0)\n            } else {\n              newBlock.type = type\n              this.addBlockAt(index + 1, newBlock)\n              this.setSelection(newBlock, newBlock, 0, 0)\n            }\n          }\n        }\n        return\n      }\n      this.onInputCrossBlocks()\n      this.setSelection(endBlock, endBlock, 0, 0)\n    },\n    onKeyTab (e) {\n      const { addTool } = this.$refs\n      if (addTool.isShow) {\n        e.preventDefault()\n        addTool.isOpen = true\n        addTool.$el.querySelector('button').focus()\n      }\n    },\n    onKeyEsc (e) {\n      const { addTool } = this.$refs\n      if (addTool.isShow) {\n        e.preventDefault()\n        addTool.isOpen = false\n      }\n    },\n    onMousedown (e) {\n      this.isSelecting = true\n      this.isOperating = false\n      // const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      // if (startBlock === endBlock && startOffset === endOffset) this.isSelecting = true\n      // console.log(this.isSelecting)\n    },\n    onFocus (e) {\n      this.isFocus = true\n      // console.log(e)\n      // console.log('focus')\n      let focusNode = e.target\n      if (focusNode.tagName === 'INPUT' || focusNode.tagName === 'TEXTAREA') return\n      if (focusNode === this.$refs.article) {\n        this.onSelectionchange()\n        this.$refs.addTool.isOpen = false\n        return\n      }\n      const selection = getSelection()\n      if (selection) selection.removeAllRanges()\n      if (!focusNode.dataset.id) {\n        focusNode = getBlockNodeByChildNode(focusNode)\n      }\n      if (!focusNode) return\n      // this.isChildFocus = true\n      const block = getBlockById(this.value.blocks, focusNode.dataset.id)\n\n      //  selection.removeAllRanges  selectionchange  this.selection\n      setTimeout(() => {\n        this.selection = {\n          blocks: [block],\n          startBlock: block,\n          endBlock: block,\n          startOffset: null,\n          endOffset: null,\n          rangeRect: getRangeRect(focusNode, this.$el),\n          blockStyle: block.type,\n          inlineStyles: null\n        }\n      }, 60)\n    },\n    onSelectionchange (e = {}) {\n      // console.log('selectionchange', e.isTrusted)\n      if (this.readonly) return\n      if (this.isComposing) return\n      this.getSelection()\n      this.getSelectedBlockStyle()\n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      if (!(startBlock === endBlock && startOffset === endOffset)) {\n        this.getSelectedInlineStyles()\n      }\n      // this.$emit('selectionchange', JSON.parse(JSON.stringify(this.selection))) // \n    },\n    getSelection () {\n      if (this.isOperating) return\n      // console.log('get selection')\n      const selection = getSelection()\n      // console.log(selection)\n      if (selection.anchorNode === this.$refs.article) {\n        selection.removeAllRanges()\n        return\n      }\n      if (selection.type === 'None') {\n        this.clearSelection()\n        return\n      }\n      const range = selection.getRangeAt(0)\n      let rangeRect\n      if (range.startContainer === range.endContainer &&\n      range.startOffset === range.endOffset) {\n        rangeRect = null\n      } else {\n        rangeRect = getRangeRect(range, this.$el)\n      }\n\n      const startNode = getBlockNodeByChildNode(range.startContainer)\n      let endNode = getBlockNodeByChildNode(range.endContainer)\n      // console.log(startNode, endNode)\n      if (!startNode) {\n        this.clearSelection()\n        return\n      }\n      if (!endNode) {\n        if (this.selection.endBlock) endNode = getNodeById(this.selection.endBlock.id)\n        else return this.clearSelection()\n      }\n\n      const startId = startNode.dataset.id\n      const endId = endNode.dataset.id\n\n      let selectedBlocks = getSelectedBlocks(this.value.blocks, startId, endId)\n      let startBlock = selectedBlocks[0]\n      let endBlock = selectedBlocks[selectedBlocks.length - 1]\n\n      let startOffset = getOffset(startNode, range.startContainer, range.startOffset)\n      let endOffset = getOffset(endNode, range.endContainer, range.endOffset)\n\n      //  0 offset \n      if (selectedBlocks.length > 1 && endOffset === 0) {\n        endBlock = selectedBlocks[selectedBlocks.length - 2]\n        endOffset = (endBlock.text || '').length\n        selectedBlocks.pop()\n      }\n\n      this.selection = {\n        startBlock,\n        endBlock,\n        startOffset,\n        endOffset,\n        rangeRect,\n        blocks: selectedBlocks\n      }\n    },\n    getSelectedBlockStyle () {\n      const { blocks } = this.selection\n      const _blocks = (blocks || []).filter(item => isTextBlock(item))\n      if (!_blocks || !_blocks.length) {\n        this.selection.blockStyle = null\n        return\n      }\n      let styles = _blocks.map(item => {\n        if (item.type === 'heading') return item.type + item.level\n        return item.type\n      })\n      styles = Array.from(new Set(styles))\n      this.selection.blockStyle = styles.length === 1 ? styles[0] : null\n    },\n    getSelectedInlineStyles () {\n      const { startBlock, endBlock, blocks, startOffset, endOffset } = this.selection\n      //  block\n      const _blocks = (blocks || []).filter(item => isTextBlock(item))\n      if (!_blocks || !_blocks.length) {\n        this.selection.inlineStyles = null\n        return\n      }\n      // console.log(_blocks.length)\n      if (_blocks.length === 1) {\n        this.selection.inlineStyles = getRangeStyles(_blocks[0].ranges, startOffset, endOffset)\n        return\n      }\n      const stylesMap = {} // { bold: [1, 1, 1] }  blocks \n      const result = {}\n      _blocks.forEach(item => {\n        let styles = {}\n        if (item === startBlock) styles = getRangeStyles(item.ranges, startOffset, item.text.length)\n        else if (item === endBlock) styles = getRangeStyles(item.ranges, 0, endOffset)\n        else styles = getRangeStyles(item.ranges, 0, item.text.length)\n        for (let key in styles) {\n          if (stylesMap[key]) stylesMap[key].push(styles[key])\n          else stylesMap[key] = [styles[key]]\n        }\n      })\n      for (let key in stylesMap) {\n        const item = stylesMap[key]\n        // console.log(item)\n        if (item.length === _blocks.length) result[key] = 1\n      }\n      this.selection.inlineStyles = result\n    },\n    addInlineStyle (style, attrs = {}) {\n      const { startBlock, endBlock, blocks, startOffset, endOffset } = this.selection\n      if (!blocks || !blocks.length) return\n\n      if (startBlock === endBlock) {\n        if (startOffset === endOffset) return\n        if (startBlock.type === 'blockcode' && style === 'code') return // \n        const newRange = { style, offset: startOffset, length: endOffset - startOffset }\n        for (let key in attrs) this.$set(newRange, key, attrs[key])\n        startBlock.ranges.push(newRange)\n        mergeRanges(startBlock.ranges)\n        startBlock.key++\n        return\n      }\n\n      blocks.forEach(item => {\n        if (!isTextBlock(item)) return\n        if (item.type === 'blockcode' && style === 'code') return // \n        const newRange = { style, offset: 0, length: 0 }\n        if (attrs) {\n          for (let key in attrs) this.$set(newRange, key, attrs[key])\n        }\n        if (item === startBlock) {\n          newRange.offset = startOffset\n          newRange.length = item.text.length - startOffset\n          item.ranges.push(newRange)\n        } else if (item === endBlock) {\n          newRange.length = endOffset\n          item.ranges.push(newRange)\n        } else {\n          newRange.length = item.text.length\n          item.ranges.push(newRange)\n        }\n        mergeRanges(item.ranges)\n        item.key++\n      })\n    },\n    removeInlineStyle (style) {\n      const { startBlock, endBlock, blocks, startOffset, endOffset } = this.selection\n      if (!blocks || !blocks.length) return\n\n      function handleItem (item, start, end) {\n        const ranges = item.ranges\n        let focusRange = ranges.filter(item => {\n          return item.style === style && item.offset <= start && item.offset + item.length >= end\n        })[0]\n        if (!focusRange) return\n        const i = ranges.indexOf(focusRange)\n        ranges.splice(i, 1)\n        if (focusRange.style !== 'link') {\n          const cutRange = { offset: start, length: end - start }\n          const newRanges = splitRange(focusRange, cutRange)\n          item.ranges = ranges.concat(newRanges)\n        }\n        mergeRanges(item.ranges)\n        item.key++\n      }\n\n      if (startBlock === endBlock) {\n        if (startOffset === endOffset) return\n        handleItem(startBlock, startOffset, endOffset)\n        return\n      }\n      blocks.forEach(item => {\n        if (!isTextBlock(item)) return\n        if (item === startBlock) {\n          handleItem(item, startOffset, item.text.length)\n        } else if (item === endBlock) {\n          handleItem(item, 0, endOffset)\n        } else {\n          handleItem(item, 0, item.text.length)\n        }\n      })\n    },\n    toggleInlineStyle (style, attrs = {}) {\n      const { inlineStyles } = this.selection\n      if (!inlineStyles) return\n      if (!inlineStyles[style]) {\n        this.addInlineStyle(style, attrs)\n      } else {\n        this.removeInlineStyle(style)\n      }\n      this.restoreSelection()\n    },\n    setBlockType (type, attrs = {}) {\n      // console.log(type, attrs)\n      const { blocks } = this.selection\n      blocks.forEach(item => {\n        if (!isTextBlock(item)) return\n        this.$set(item, 'type', type)\n        if (type === 'todolist') this.$set(item, 'checked', false)\n        for (let key in attrs) this.$set(item, key, attrs[key])\n      })\n    },\n    clearBlockType () {\n      const { blocks } = this.selection\n      let attrs = ['type', 'id', 'key', 'text', 'ranges']\n      blocks.forEach(item => {\n        if (!isTextBlock(item)) return\n        for (let key in item) if (!attrs.includes(key)) delete item[key]\n        this.$set(item, 'type', 'paragraph')\n        this.$set(item, 'key', 0)\n        this.$set(item, 'text', item.text || '')\n        this.$set(item, 'ranges', item.ranges || [])\n      })\n    },\n    toggleBlockType (type, attrs = {}) {\n      const { blockStyle, startBlock } = this.selection\n      let isSame = type === blockStyle\n      //  heading \n      if (startBlock.type === 'heading') isSame = blockStyle === type + attrs.level\n      if (isSame) {\n        this.clearBlockType()\n      } else {\n        this.setBlockType(type, attrs)\n      }\n      this.restoreSelection()\n    },\n    restoreSelection () {\n      const { startBlock, endBlock, startOffset, endOffset } = this.selection\n      this.setSelection(startBlock, endBlock, startOffset, endOffset)\n    },\n    setSelection (startBlock, endBlock, startOffset, endOffset) {\n      this.$nextTick(() => {\n        try {\n          const startNode = getNodeById(startBlock.id)\n          const endNode = getNodeById(endBlock.id)\n          const start = getFocusNodeAndOffset(startNode, startOffset)\n          const end = (startBlock === endBlock && startOffset === endOffset)\n            ? start\n            : getFocusNodeAndOffset(endNode, endOffset)\n          // console.log(start, end)\n          const selection = getSelection()\n          const range = document.createRange()\n          range.setStart(start.focusNode, start.focusOffset)\n          range.setEnd(end.focusNode, end.focusOffset)\n          selection.removeAllRanges()\n          selection.addRange(range)\n        } catch (err) {\n          console.warn('setRange failed: ' + err.message)\n        }\n      })\n    },\n    clearSelection () {\n      for (let key in this.selection) this.selection[key] = null\n    },\n    addBlockAt (index, block) {\n      if (!block) return\n      block.type = block.type || 'paragraph'\n      this.value.blocks.splice(index, 0, block)\n    },\n    removeBlock (block) {\n      if (!block) return\n      const { blocks } = this.value\n      const i = blocks.indexOf(block)\n      if (i < 0) return\n      blocks.splice(i, 1)\n    },\n    getValue (e) {\n      const value = JSON.parse(JSON.stringify(this.value))\n      value.blocks.forEach(block => {\n        delete block.id\n        delete block.key\n        if (block.ranges && block.ranges.length) {\n          const { text } = block\n          if (text === undefined && block.ranges) {\n            delete block.ranges\n            return\n          }\n          block.ranges.forEach((range, i) => {\n            const { offset, length } = range\n            if (offset < 0) range.offset = 0\n            if (offset + length > text.length) range.length = text.length - offset\n            if (!length) {\n              block.ranges.splice(i, 1)\n            }\n          })\n        }\n      })\n      return value\n    },\n    historyForward () {\n      const { list } = this.history\n      const historyItem = {\n        value: JSON.stringify(this.value)\n      }\n      historyItem.selection = JSON.stringify(this.selection)\n      list.push(historyItem)\n      if (list.length > 20) list.shift()\n      this.history.index = list.length - 1 || 0\n    },\n    historyBack () {\n      const { list } = this.history\n      if (list.length < 2) return\n      this.isHistoryBacking = true\n      list.pop()\n      const historyItem = list[list.length - 1]\n      // const prevItem = list[list.length - 2]\n      this.value.blocks = JSON.parse(historyItem.value).blocks\n      this.selection = JSON.parse(historyItem.selection)\n      // if (prevItem) this.selection = JSON.parse(prevItem.selection)\n      this.restoreSelection()\n    }\n  }\n}\n","<template>\n  <div id=\"app\">\n    <div class=\"main\">\n      <div class=\"editor-container\">\n        <editor :readonly=\"readonly\" :value=\"testValue\" ref=\"editor\"></editor>\n      </div>\n      <!-- <div class=\"json-container\">\n        <json-viewer :value=\"testValue\" :expand-depth=\"5\"></json-viewer>\n      </div> -->\n    </div>\n    <!-- <div class=\"info-box\">\n      <div><span>blockStyle: </span>{{selection.blockStyle || 'null'}}</div>\n      <div><span>inlineStyles: </span>{{selection.inlineStyles || 'null'}}</div>\n      <div><span>offset: </span>{{selection.startOffset || 'null'}}, {{selection.endOffset || 'null'}}</div>\n    </div> -->\n    <button @click=\"getValue\">Get value</button>\n    <button @click=\"readonly = !readonly\">readonly: {{readonly}}</button>\n  </div>\n</template>\n\n<script>\n// import JsonViewer from 'vue-json-viewer'\nimport '@/components/editor/style/index.scss'\nimport testValue from './components/editor/value.json'\nimport Editor from '@/components/editor/editor'\n\nexport default {\n  components: { Editor },\n  data () {\n    return {\n      readonly: false,\n      testValue,\n      selection: {}\n    }\n  },\n  methods: {\n    getValue () {\n      console.log(this.$refs.editor.getValue())\n    },\n    onSelectionchange (selection) {\n      this.selection = selection\n    },\n    onFileChange (e) {\n      const file = e.target.files[0]\n      console.log(file)\n      const url = URL.createObjectURL(file)\n      const img = new Image()\n      img.src = url\n      document.body.appendChild(img)\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\">\nbody{background: #fff;margin: 0;}\n  #app{margin: 60px auto;font-size: 16px;}\n  .main{display: flex;}\n  .editor-container, .json-container{\n    flex: 1;\n  }\n  .editor{max-width: 800px;margin: 0 auto;}\n  .json-container {max-height: 800px;overflow-y: auto}\n  .info-box{\n    position: fixed;bottom: 0;left: 0;padding: 10px;\n    font-size: 14px;\n    span{color: #888}\n  }\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=614583a9&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue'\nimport Vuex from 'vuex'\n\nVue.use(Vuex)\n\nexport default new Vuex.Store({\n  state: {\n\n  },\n  mutations: {\n\n  },\n  actions: {\n\n  }\n})\n","import Vue from 'vue'\nimport App from './App.vue'\n// import router from './router'\nimport store from './store'\n\nVue.config.productionTip = false\n\nnew Vue({\n  // router,\n  store,\n  render: h => h(App)\n}).$mount('#app')\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../node_modules/css-loader/index.js??ref--8-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../node_modules/sass-loader/lib/loader.js??ref--8-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}
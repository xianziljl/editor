(function(t){function e(e){for(var i,r,l=e[0],a=e[1],c=e[2],h=0,u=[];h<l.length;h++)r=l[h],n[r]&&u.push(n[r][0]),n[r]=0;for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(t[i]=a[i]);d&&d(e);while(u.length)u.shift()();return s.push.apply(s,c||[]),o()}function o(){for(var t,e=0;e<s.length;e++){for(var o=s[e],i=!0,l=1;l<o.length;l++){var a=o[l];0!==n[a]&&(i=!1)}i&&(s.splice(e--,1),t=r(r.s=o[0]))}return t}var i={},n={app:0},s=[];function r(e){if(i[e])return i[e].exports;var o=i[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=i,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(o,i,function(e){return t[e]}.bind(null,i));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/editor/";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],a=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var d=a;s.push([0,"chunk-vendors"]),o()})({0:function(t,e,o){t.exports=o("56d7")},"56d7":function(t,e,o){"use strict";o.r(e);o("cadf"),o("551c"),o("f751"),o("097d");var i=o("2b0e"),n=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{attrs:{id:"app"}},[o("div",{staticClass:"main"},[o("div",{staticClass:"editor-container"},[o("editor",{ref:"editor",attrs:{readonly:t.readonly,value:t.testValue}})],1)]),o("button",{on:{click:t.getValue}},[t._v("Get value")]),o("button",{on:{click:function(e){t.readonly=!t.readonly}}},[t._v("readonly: "+t._s(t.readonly))])])},s=[],r=(o("fa44"),o("f164")),l=(o("4f7f"),o("5df3"),o("1c4c"),o("6b54"),o("28a5"),o("ac6a"),o("a481"),o("6762"),o("2fdb"),o("48c0"),o("7f7f"),{inject:["$editor","$tool"],data:function(){return{isActive:!1,isDisabled:!1}},render:function(t){return t("button",{class:["editor-tool-btn",this.$options.name,this.isActive?"editor-tool-btn-on":"",this.isDisabled?"editor-tool-btn-disabled":""],attrs:{disabled:this.isDisabled},on:{click:this.onClick}})}}),a={name:"editor-tool-bold",mixins:[l],watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.bold}},methods:{onClick:function(t){this.$editor.toggleInlineStyle("bold"),this.$editor.isOperating=!1}}},c={name:"editor-tool-italic",mixins:[l],watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.italic}},methods:{onClick:function(t){this.$editor.toggleInlineStyle("italic"),this.$editor.isOperating=!1}}},d=(o("b54a"),{name:"editor-tool-link",mixins:[l],data:function(){return{isInput:!1}},watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.link},"$tool.isShow":function(){this.isInput=!1}},render:function(t){var e=[t("button",{class:["editor-tool-btn","editor-tool-link",this.isActive?"editor-tool-btn-on":""],on:{click:this.onClick}})];if(this.isInput){var o=t("input",{attrs:{placeholder:"输入链接并回车"},on:{keydown:this.onKeydown}});e.push(o)}return t("div",{class:"editor-tool--link"},e)},methods:{onClick:function(t){var e=this,o=this.$editor.selection.inlineStyles;o.link?(this.$editor.toggleInlineStyle("link"),this.$editor.isOperating=!1,this.isInput=!1):(this.isInput=!0,this.$nextTick(function(){e.$el.querySelector("input").focus()}))},onKeydown:function(t){if(t.stopPropagation(),!t.isComposing){if(13===t.keyCode){if(t.preventDefault(),!t.target.value)return;return this.$editor.toggleInlineStyle("link",{href:t.target.value}),this.$editor.isOperating=!1,this.$tool.close(),void(this.isInput=!1)}27===t.keyCode&&(this.$editor.isOperating=!1,this.$tool.close(),this.isInput=!1)}}}}),h={name:"editor-tool-code",mixins:[l],watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.code}},methods:{onClick:function(t){this.$editor.toggleInlineStyle("code"),this.$editor.isOperating=!1}}},u={name:"editor-tool-hilight",mixins:[l],watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.hilight}},methods:{onClick:function(t){this.$editor.toggleInlineStyle("hilight"),this.$editor.isOperating=!1}}},f={name:"editor-tool-strikethrough",mixins:[l],watch:{"$editor.selection.inlineStyles":function(t){this.isActive=t&&t.strikethrough}},methods:{onClick:function(t){this.$editor.toggleInlineStyle("strikethrough"),this.$editor.isOperating=!1}}},g={name:"editor-tool-blockquote",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"blockquote"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("blockquote"),this.$editor.isOperating=!1}}},p={name:"editor-tool-unorderlist",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"unorderlist"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("unorderlist"),this.$editor.isOperating=!1}}},v={name:"editor-tool-orderlist",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"orderlist"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("orderlist"),this.$editor.isOperating=!1}}},y={name:"editor-tool-todolist",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"todolist"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("todolist"),this.$editor.isOperating=!1}}},k={name:"editor-tool-heading-1",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"heading1"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("heading",{level:1}),this.$editor.isOperating=!1}}},m={name:"editor-tool-heading-2",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"heading2"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("heading",{level:2}),this.$editor.isOperating=!1}}},b={name:"editor-tool-delete",mixins:[l],methods:{onClick:function(t){var e=this.$editor.selection.startBlock;this.$editor.removeBlock(e),this.$editor.clearSelection(),this.$editor.isOperating=!1}}};function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,o="x"===t?e:3&e|8;return o.toString(16)})}var w=x,S={name:"editor-tool-image",inject:["$editor","$tool"],data:function(){return{multiple:!0}},watch:{"$editor.selection.startBlock":function(t){this.multiple=!(t&&"image"===t.type)}},render:function(t){var e=t("input",{attrs:{type:"file",accept:"image/jpg, image/jpeg, image/png, image/gif",multiple:this.multiple},style:{display:"none"},on:{change:this.onChange}});return t("label",{class:["editor-tool-btn","editor-tool-image"],attrs:{tabindex:0}},[e])},methods:{onChange:function(t){var e=this,o=t.target.files;if(o.length){o=Array.from(o),console.log(o);var i=this.$editor.selection.startBlock;if(i){var n="image"===i.type,s=n?i.row:Math.random().toString(16).substr(2),r=o.map(function(t){var e={type:"image",id:n?i.id:w(),key:0,src:URL.createObjectURL(t),alt:t.name,text:"",width:0,height:0,row:s,file:t};return e});if(n){var l=r[0];for(var a in l)i[a]=l[a]}else{var c=this.$editor.value.blocks.indexOf(i);this.$editor.removeBlock(i),r.forEach(function(t){e.$editor.addBlockAt(c,t),c++})}this.$editor.isOperating=!1,this.$tool.isShow=!1}}}}},$={name:"editor-tool-video",inject:["$editor","$tool"],render:function(t){var e=t("input",{attrs:{type:"file",accept:"video/mp4"},style:{display:"none"},on:{change:this.onChange}});return t("label",{class:["editor-tool-btn","editor-tool-video"],attrs:{tabindex:0}},[e])},methods:{onChange:function(t){var e=t.target.files;if(e.length){var o=this.$editor.selection.startBlock;if(o){var i="image"===o.type,n=Array.from(e)[0],s={type:"video",id:i?o.id:w(),key:0,src:URL.createObjectURL(n),poster:"",name:n.name,text:"",width:0,height:0};if(i)for(var r in s)o[r]=s[r];else{var l=this.$editor.value.blocks.indexOf(o);this.$editor.removeBlock(o),this.$editor.addBlockAt(l,s)}this.$editor.isOperating=!1,this.$tool.isShow=!1}}}}},B={name:"editor-tool-divider",mixins:[l],methods:{onClick:function(){this.$editor.toggleBlockType("divider"),this.$editor.isOperating=!1}}},O={name:"editor-tool-blockcode",mixins:[l],watch:{"$editor.selection.blockStyle":function(t){this.isActive=t&&"blockcode"===t}},methods:{onClick:function(){this.$editor.toggleBlockType("blockcode"),this.$editor.isOperating=!1}}},C={name:"editor-tool-table",mixins:[l],methods:{onClick:function(){var t=this.$editor.selection.startBlock,e={type:"table",id:t.id,key:0,rows:[["",""],["",""]]},o=this.$editor.value.blocks.indexOf(t);this.$editor.removeBlock(t),this.$editor.addBlockAt(o,e),this.$editor.isOperating=!1,this.$tool.isShow=!1}}},E=(o("4917"),{name:"editor-tool-attach",inject:["$editor","$tool"],render:function(t){var e=t("input",{attrs:{type:"file"},style:{display:"none"},on:{change:this.onChange}});return t("label",{class:["editor-tool-btn","editor-tool-attach"],attrs:{tabindex:0}},[e])},methods:{onChange:function(t){var e=t.target.files;if(e.length){var o=this.$editor.selection.startBlock;if(o){var i=Array.from(e)[0],n=i.name.match(/\.\w+$/),s={type:"attach",id:o.id,key:0,name:i.name,url:URL.createObjectURL(i),size:i.size,ext:n?n[0]:""},r=this.$editor.value.blocks.indexOf(o);this.$editor.removeBlock(o),this.$editor.addBlockAt(r,s),this.$editor.isOperating=!1,this.$tool.isShow=!1}}}}}),T={bold:a,italic:c,link:d,code:h,hilight:u,strikethrough:f,blockquote:g,orderlist:v,unorderlist:p,todolist:y,heading1:k,heading2:m,delete:b,hr:"hr",image:S,video:$,divider:B,blockcode:O,table:C,attach:E},A=["bold","italic","strikethrough","link","code","hilight","hr","heading1","heading2","blockquote","unorderlist"],I={paragraph:A,heading1:A,heading2:A,heading3:A,heading4:A,blockquote:A,orderlist:A,unorderlist:A,todolist:A,blockcode:["bold","italic","strikethrough","link","hilight","hr","heading1","heading2","blockquote","unorderlist"],image:["image","hr","delete"],divider:["delete"],video:["video","hr","delete"],table:["delete"],attach:["delete"]},M={toolMap:T,toolItems:I},P=M.toolMap,j=M.toolItems,D={name:"editor-tool-popup",inject:["$editor"],data:function(){return{isShow:!1,position:{},items:[]}},provide:function(){return{$tool:this}},render:function(t){var e=this.items,o=this.position,i=o.x,n=o.y,s=o.arrowX,r=(e||[]).map(function(e){return t(P[e])});return r.push(t("i",{class:"editor-tool-popup-arrow",style:{left:s+"%"}})),t("div",{class:["editor-tool-popup","",this.isShow?"editor-tool-popup-show":""],style:{left:i+"px",top:n+"px"},on:{mousedown:this.onMousedown},key:1},r)},watch:{"$editor.isSelecting":function(t){this.isShow=!t&&this.$editor.selection.rangeRect,this.isShow&&this.$nextTick(this.getPosition)},"$editor.selection.rangeRect":function(t){this.isShow=!this.$editor.isSelecting&&t,this.isShow?this.$nextTick(this.getPosition):this.position={x:0,y:0,arrowX:50}},"$editor.selection.blockStyle":function(t){this.items=j[t||"paragraph"]}},methods:{getPosition:function(){var t=this.$editor.selection.rangeRect;if(t&&this.$el){var e=0,o=this.$el,i=o.clientWidth,n=o.clientHeight,s=this.$el.parentNode.clientWidth,r=t.left,l=t.top,a=t.width,c=~~(r+(a-i)/2),d=~~(l-n-10),h=50;c<e&&(c=e),c+i+e>s&&(c=s-i-e),h=(r-c+a/2)/i*100,this.position={x:c,y:d,arrowX:h}}else this.position={x:0,y:0,arrowX:50}},onMousedown:function(t){this.$editor.isOperating=!0},close:function(t){this.$editor.isOperating=!1,this.$editor.selection.rangeRect=null}}},L=(o("55dd"),{inject:["$editor"],props:{readonly:Boolean,value:{type:Object,default:function(){return{}}}}});function R(t,e,o){return t("a",{attrs:{class:"link",href:o._href,target:"blank","data-tip":o._href},on:e.readonly?null:{click:function(t){(t.ctrlKey||t.metaKey)&&window.open(o._href)}}},[o])}var _=function(t,e,o,i){var n=o.length,s=[],r=e._v;if(!i||!i.length)return[r(o)];var l=new Set;i.forEach(function(t){var e=t.offset,o=t.offset+t.length;l.add(e<0?0:e),l.add(o<0?0:o)}),l.add(0),l.add(n+1),l=Array.from(l).sort(function(t,e){return t-e}),l.forEach(function(e,n){var a=l[n+1];if(a){var c=new Set,d="";i.forEach(function(t){e>=t.offset&&a<=t.offset+t.length&&(c.add(t.style),"link"===t.style&&(d=t.href))});var h=o.slice(e,a);if(h){var u=r(h);c.forEach(function(e){var o=tt[e]||"span";"link"!==e&&o&&(u=t(o,[u]))}),c.has("link")&&(u._href=d),s.push(u)}}});var a=new Set,c=null;return s.forEach(function(o){o._href?c&&o._href===c.children[0]._href?c.children.push(o):c=R(t,e,o):(a.add(o),c=null),c&&a.add(c)}),Array.from(a)},K={name:"editor-block-heading",mixins:[L],render:function(t){var e=this.value,o=e.text,i=e.ranges,n=e.key,s=e.level,r="h"+(s||1);return t("div",{key:n,attrs:{id:"user-content-".concat(o)}},[t(r,_(t,this,o,i))])}},N={name:"editor-block-paragraph",mixins:[L],render:function(t){var e=this.value,o=e.text,i=e.ranges,n=e.key;return t("div",{key:n,class:o&&o.length?"":"editor-block-paragraph-empty"},[t("p",_(t,this,o,i))])}},F={name:"editor-block-blockquote",mixins:[L],render:function(t){var e=this.value,o=e.text,i=e.ranges,n=e.key;return t("div",{key:n},[t("blockquote",_(t,this,o,i))])}},q={name:"editor-block-divider",mixins:[L],data:function(){return{isSelected:!1}},watch:{"$editor.selection.blocks":function(t){this.isSelected=t&&t.includes(this.value)}},render:function(t){return t("hr",this.readonly?{}:{class:this.isSelected?"editor-block-selected":"",attrs:{tabindex:0}})}},H={name:"editor-list-item",mixins:[L],render:function(t){var e=this.value,o=e.text,i=e.ranges,n=e.key;return t("li",{key:n},_(t,this,o,i))}},U={name:"editor-checkbox",props:{checked:Boolean,disabled:Boolean},render:function(t){return t("label",{class:["editor-checkbox",this.checked?"editor-checkbox-checked":"",this.disabled?"editor-checkbox-disabled":""],attrs:{"data-skip-check":1,contenteditable:!1},on:{change:this.onChange}},[t("input",{attrs:{type:"checkbox","data-skip-check":1,checked:this.checked,disabled:this.disabled}})])},methods:{onChange:function(t){t.stopPropagation(),this.$emit("change",t.target.checked),console.log("on change",t.target.checked)}}},J={name:"editor-todo-item",mixins:[L],render:function(t){var e=this.readonly,o=this.value,i=o.text,n=o.ranges,s=o.key,r=o.checked,l=t("div",{class:"editor-todo-content"},_(t,this,i,n)),a=t(U,{props:{disabled:e,checked:r},on:{change:function(t){o.checked=t}}});return t("li",{class:r?"editor-todo-checked":"",on:Object.assign({},this.$listeners,{}),key:s},[a,l])}},W={name:"editor-block-image",mixins:[L],data:function(){return{isSelected:!1}},watch:{"$editor.selection.blocks":function(t){this.isSelected=t&&t.includes(this.value)}},render:function(t){var e,o=this.readonly,i=this.value,n=i.src,s=i.alt,r=i.text,l=i.width,a=i.height,c=t("img",{attrs:{src:n,alt:s,width:l,height:a,draggable:o},on:{load:function(t){i.width=t.target.naturalWidth,i.height=t.target.naturalHeight}}}),d="editor-block-desc";return e=o?t("figcaption",{class:d},[r]):t("input",{class:d,attrs:{type:"text",value:r,placeholder:"写点儿说明文字"},on:{input:function(t){i.text=t.target.value},paste:function(t){t.stopPropagation()},selectionchange:function(t){t.stopPropagation()},keydown:function(t){t.stopPropagation()}}}),t("figure",{class:this.isSelected?"editor-block-selected":"",attrs:{tabindex:o?null:1,contenteditable:!1},style:{flex:100/a*l}},[c,e])}},V={name:"editor-block-images",inject:["$editor"],props:{readonly:Boolean,value:{type:Object,default:function(){return{}}}},render:function(t){var e=this.value,o=this.readonly,i=e.images.map(function(e){var i=100/e.height*e.width;return t(W,{props:{readonly:o,value:e,width:i}})});return t("div",{},i)}},X={name:"editor-blockcode-line",mixins:[L],render:function(t){var e=this.value,o=e.text,i=e.ranges,n=e.key;return t("div",{key:n},_(t,this,o,i))}},z={name:"editor-block-video",mixins:[L],data:function(){return{isSelected:!1}},watch:{"$editor.selection.blocks":function(t){this.isSelected=t&&t.includes(this.value)}},render:function(t){var e,o=this.readonly,i=this.value,n=i.src,s=i.text,r=i.poster,l=i.width,a=i.height,c=t("video",{attrs:{src:n,controls:!0,poster:r,width:l,height:a},on:{loadedmetadata:function(t){var e=t.target;e.readyState>0&&(i.width=e.videoWidth,i.height=e.videoHeight)}}}),d="editor-block-desc";return e=o?t("figcaption",{class:d},[s]):t("input",{class:d,attrs:{type:"text",value:s,placeholder:"写点儿说明文字"},on:{input:function(t){i.text=t.target.value},paste:function(t){t.stopPropagation()},selectionchange:function(t){t.stopPropagation()}}}),t("div",{class:[this.isSelected?"editor-block-selected":""],attrs:{tabindex:o?null:1,contenteditable:!1}},[c,e])}},G=(o("6c7b"),{name:"editor-block-table",mixins:[L],data:function(){return{isSelected:!1,isFocus:!1,selection:{rows:[],cols:[]},hover:{row:null,col:null}}},watch:{"$editor.selection.blocks":function(t){this.isSelected=t&&t.includes(this.value)}},render:function(t){var e,o,i=this,n=this.value,s=this.readonly,r=this.selection,l=(n.rows||[]).map(function(e,o){var l=e.map(function(e,l){var a=null,c=null,d=null,h=null,u=null;return s||(a=t("textarea",{attrs:{rows:"1"},on:{input:function(t){i.onInput(o,l,t)},focus:i.onTextareaFocus,paste:i.onPaste},key:n.key},[e]),0===o&&(d=t("button",{class:"editor-table-addbtn editor-table-addbtn-col",attrs:{"data-col":l},on:{mouseenter:function(t){i.hover.col=l},mouseleave:function(t){i.hover.col=null},click:i.onAddBtnClick}}),u=t("button",{class:"editor-table-selcolbtn",attrs:{"data-col":l},on:{click:i.onSelBtnClick}})),0===l&&(c=t("button",{class:"editor-table-addbtn",attrs:{"data-row":o},on:{mouseenter:function(t){i.hover.row=o},mouseleave:function(t){i.hover.row=null},click:i.onAddBtnClick}}),h=t("button",{class:"editor-table-selrowbtn",attrs:{"data-row":o},on:{click:i.onSelBtnClick}}))),t("td",{class:{"editor-table-col-hover":i.hover.col===l,"editor-table-row-selected":r.rows.includes(o),"editor-table-col-selected":r.cols.includes(l)}},[t("div",{class:"td"},[e,a]),h,c,u,d])});return t("tr",{class:{"editor-table-row-hover":i.hover.row===o}},l)});s||(e=t("div",{class:"editor-block-table-addrowbtn",attrs:{"data-row":n.rows.length},on:{click:this.onAddBtnClick}}),o=t("div",{class:"editor-block-table-addcolbtn",attrs:{"data-col":n.rows[0].length},on:{click:this.onAddBtnClick}}));var a=t("table",l),c=t("div",{class:"editor-block-table-container"},[a,e,o]);return t("div",{class:{"editor-block-selected":this.isSelected,"editor-block-table-focused":this.isFocus},on:{keydown:this.onKeydown,mousedown:this.$editor.clearSelection},attrs:{contenteditable:!1,tabindex:1}},[c])},mounted:function(){var t=this;document.addEventListener("mousedown",this.onDoucumentMousedown),this.$once("hook:beforeDestroy",function(){document.removeEventListener("mousedown",t.onDoucumentMousedown)})},methods:{onInput:function(t,e,o){o.stopPropagation();var i=this.value.rows[t];this.$set(i,e,o.target.value)},onKeydown:function(t){console.log(t.keyCode);var e=t.ctrlKey||t.metaKey;90===t.keyCode&&e&&t.stopPropagation(),8===t.keyCode&&this.onKeyBackspace(t),13===t.keyCode&&(t.stopPropagation(),t.preventDefault(),this.onKeyEnter(t))},onKeyEnter:function(t){if("TEXTAREA"===t.target.tagName){var e=Array.from(this.$el.querySelectorAll("textarea")),o=e.indexOf(t.target);if(o<e.length-1)e[o+1].focus();else{var i=this.$editor.value.blocks.indexOf(this.value),n={type:"paragraph",id:w(),key:0,text:"",ranges:[]};this.$editor.addBlockAt(i+1,n),this.isFocus=!1,this.$editor.isOperating=!1,this.$editor.setSelection(n,n,0,0)}}},onPaste:function(t){t.stopPropagation()},onDoucumentMousedown:function(t){if(!this.readonly){var e=t.path||t.composedPath&&t.composedPath();this.isFocus=e.includes(this.$el),this.isFocus?this.$editor.isOperating=!0:this.selection={rows:[],cols:[]}}},onAddBtnClick:function(t){var e=t.target.dataset,o=e.row,i=e.col;void 0!==o&&this.addRow(~~o),void 0!==i&&this.addCol(~~i),this.selection={cols:[],rows:[]}},addRow:function(t){var e=this.value.rows,o=new Array(e[0].length);o.fill(""),e.splice(t,0,o),this.value.key++},addCol:function(t){var e=this.value.rows;e.forEach(function(e){e.splice(t,0,"")}),this.value.key++},onSelBtnClick:function(t){var e=t.target.dataset,o=e.row,i=e.col;void 0!==o&&this.selRow(~~o),void 0!==i&&this.selCol(~~i)},selRow:function(t){this.selection.cols=[],this.selection.rows=[t]},selCol:function(t){this.selection.rows=[],this.selection.cols=[t]},onTextareaFocus:function(t){this.selection={cols:[],rows:[]}},onKeyBackspace:function(t){var e=this,o=this.selection,i=o.rows,n=o.cols;if(i.length||n.length){i.length&&(t.preventDefault(),i.forEach(function(t,o){e.value.rows.splice(t,1)})),n.length&&(t.preventDefault(),this.value.rows.forEach(function(t,e){t.forEach(function(e,o){n.includes(o)&&t.splice(o,1)})})),this.selection={rows:[],cols:[]};var s=this.value.rows;this.value.key++,s.length&&s[0].length||this.$editor.removeBlock(this.value)}}}});function Z(t){var e=parseInt(t);return e?e<1024?e+" B":e>=1024&&e<1048576?(e/1024).toFixed(1)+" KB":e>=1048576&&e<1073741824?(e/1048576).toFixed(1)+" MB":(e/1073741824).toFixed(1)+" GB":"0 B"}var Q=Z,Y={name:"editor-block-attach",mixins:[L],data:function(){return{isSelected:!1}},watch:{"$editor.selection.blocks":function(t){this.isSelected=t&&t.includes(this.value)}},render:function(t){var e=this.value,o=t("div",{class:["editor-attach-icon","editor-attach-icon-"+e.ext]}),i=t("div",{class:"editor-attach-name"},[e.name]),n=t("div",{class:"editor-attach-size"},[Q(e.size)]),s=t("a",{class:"editor-attach-download",attrs:{href:this.value.url,download:this.value.name,target:"blank"}}),r=t("div",{class:"editor-attach-content"},[i,n]),l=t("div",{class:"editor-attach-container"},[o,r,s]);return t("div",{class:{"editor-block-selected":this.isSelected},attrs:{contenteditable:!1,tabindex:1}},[l])}},tt={bold:"strong",italic:"em",link:"a",underline:"ins",strikethrough:"del",hilight:"mark",code:"code"},et={heading:K,paragraph:N,blockquote:F,divider:q,orderlist:H,unorderlist:H,todolist:J,images:V,image:W,blockcode:X,video:z,table:G,attach:Y},ot={heading:K,paragraph:N,blockquote:F,orderlist:H,unorderlist:H,todolist:J,blockcode:X},it={orderlist:"ol",unorderlist:"ul",todolist:"ul",blockcode:"code",image:"div"};function nt(t){return!!t&&!!ot[t.type]}function st(t){return t?t.dataset&&t.dataset.id?t:st(t.parentNode):null}function rt(t){return document.querySelector('[data-id="'.concat(t,'"]'))}function lt(t,e){return t&&t.length&&e&&t.filter(function(t){return t.id===e})[0]||null}function at(t,e,o){var i=new Set,n=!1;return t.forEach(function(t){t.id===e&&(i.add(t),n=!0),t.id===o&&(i.add(t),n=!1),n&&i.add(t)}),Array.from(i)}function ct(t,e){if(!e||!t)return null;var o=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{left:o.left-i.left,top:o.top-i.top,width:o.width,height:o.height}}function dt(t,e,o){var i=o;if(t===e)return o;function n(t,e){return e?e.parentNode===t?e:n(t,e.parentNode):null}var s=n(t,e);if(!s)return null;s.childNodes&&s.childNodes.length&&(i=dt(s,e,o));for(var r=t.childNodes,l=r.length,a=0;a<l;a++){var c=r[a];if(c===s)break;3===c.nodeType?i+=c.length:i+=c.innerText.length}return i}function ht(t,e,o){var i={};return t?(t.forEach(function(t){var n=t.offset+t.length,s=o-e<=0&&e===t.offset;if(!s&&e>=t.offset&&o<=n){var r=t.style;i[r]=1}}),i):i}function ut(t){function e(o){var i=!1;o.forEach(function(t,e){o.forEach(function(e,n){if(t!==e&&t.style===e.style&&("link"!==t.style||t.href===e.href)){var s=t.offset,r=t.offset+t.length,l=e.offset,a=e.offset+e.length;l>=s&&l<=r&&(i=!0,o.splice(n,1),t.offset=Math.min(s,l),t.length=Math.max(r,a)-t.offset)}})}),i&&e(t)}t&&(t.length<2||e(t))}function ft(t,e){var o=t.style,i=[t.offset,t.offset+t.length,e.offset,e.offset+e.length].sort(function(t,e){return t-e});return[{offset:i[0],length:i[1]-i[0],style:o},{offset:i[2],length:i[3]-i[2],style:o}].filter(function(t){return t.offset>=0&&t.length>0})}function gt(t,e){var o=0;function i(t,e){o+=1;var n=0,s=t,r=0;if(!t)return{focusNode:s,focusOffset:r};for(var l=t.childNodes,a=l.length,c=0;c<a;c++){var d=l[c];if(!d.dataset||!d.dataset.skipCheck){var h=d.length;if(h>=0||(h=d.innerText?d.innerText.length:0),n+=h,n>=e){s=d,r=h-(n-e);break}c===a-1&&(s=d,r=n)}}return 3===s.nodeType?(o=0,{focusNode:s,focusOffset:r}):o>1e3?(o=0,{focusNode:s,focusOffset:r}):i(s,r)}return i(t,e)}function pt(t,e,o){var i=e.offset,n=e.offset+e.length,s=o-e.length;t.forEach(function(t,e){var r=t.offset,l=t.offset+t.length;if(!(i>=l))if(n<=r)t.offset+=s;else if(i<=r&&n>=l)t.offset=t.length=0;else{if(!(i>=r&&n<=l))return i<r&&n>r?(t.offset=i+o,void(t.length-=n-r)):void(i<l&&n>l&&(t.length-=l-i));t.length+=s}})}function vt(t,e){if(!nt(t))return null;var o=e.offset,i=e.offset+e.length,n=t.text.slice(0,o),s=t.text.slice(i,t.text.length),r=[],l=[];t.ranges.forEach(function(t){var e=t.offset,n=t.offset+t.length;if(n<=o)r.push(t);else{if(e>=i)return t.offset-=i,void l.push(t);if(!(e>o&&n<i))if(o>e&&i<n){t.length=o-e,r.push(t);var s={offset:0,length:n-i,style:t.style};for(var a in t)void 0===s[a]&&(s[a]=t[a]);l.push(s)}else{if(e>o&&e<i)return t.offset=0,t.length=n-i,void l.push(t);n>o&&n<i&&(t.length=o-e,r.push(t))}}}),t.text=n,t.ranges=r;var a={id:w(),key:0,text:s,ranges:l};return a}function yt(t,e){nt(t)&&nt(e)&&(e.ranges.forEach(function(e){e.offset+=t.text.length}),t.ranges=t.ranges.concat(e.ranges),t.text+=e.text)}var kt=M.toolMap,mt=["heading1","heading2","blockquote","unorderlist","orderlist","todolist","hr","image","video","table","blockcode","divider","attach"],bt={name:"editor-tool-add",inject:["$editor"],provide:function(){return{$tool:this}},data:function(){return{isShow:!1,isOpen:!1,position:{}}},watch:{"$editor.selection.startBlock":function(t){var e=this.$editor.selection.endBlock;this.isShow=t&&t===e&&"paragraph"===t.type&&!t.text.length,this.isShow?this.$nextTick(this.getPosition):this.isOpen=!1}},render:function(t){var e=this,o=this.isShow,i=this.isOpen,n=this.position,s=n.x,r=n.y,l=t("button",{class:["editor-tool-btn","editor-tool-add-btn"],attrs:{"data-tip":"Add: ⟶| tab"},on:{click:function(t){e.isOpen=!e.isOpen}}}),a=mt.map(function(e){return t(kt[e])}),c=t("div",{class:"editor-tool-add-btns",on:{mousedown:this.onMousedown}},a);return t("div",{class:["editor-tool-add",o?"editor-tool-add-show":"",i?"editor-tool-add-open":""],style:{left:s+"px",top:r+"px"},on:{keydown:this.onKeydown}},[l,c])},methods:{getPosition:function(){var t=this.$editor.selection.startBlock,e=rt(t.id);if(e){var o=e.clientHeight,i=this.$el.clientHeight,n=ct(e,this.$editor.$el);this.position={x:n.left+5,y:n.top+(o-i)/2}}else this.position={x:0,y:0}},onMousedown:function(t){this.$editor.isOperating=!0},onKeydown:function(t){switch(t.keyCode){case 27:this.isOpen=!1,this.$editor.restoreSelection();break;case 9:this.isOpen=!0;break}}}},xt={name:"editor-tool-tip",data:function(){return{isShow:!1,isEnter:!1,content:"",target:null,x:0,y:0,arrowX:50,timer:null}},render:function(t){var e=this.isShow,o=this.content,i=this.x,n=this.y,s=this.arrowX,r=t("i",{class:"editor-tool-tip-arrow",style:{left:s+"%"}});return t("div",{class:["editor-tool-tip",e?"editor-tool-tip-show":""],style:{left:i+"px",top:n+"px"}},[o,r])},mounted:function(){this.addListeners()},methods:{addListeners:function(){var t=this,e=this.$el.parentNode;e.addEventListener("mouseenter",this.onMouseenter,!0),e.addEventListener("mouseleave",this.onMouseleave,!0),this.$once("hook:beforeDestroy",function(){e.removeEventListener("mouseenter",t.onMouseenter,!0),e.removeEventListener("mouseleave",t.onMouseleave,!0)})},onMouseenter:function(t){var e=this,o=t.target;o.dataset.tip&&!this.isEnter&&(this.target=o,this.isEnter=!0,this.timer=setTimeout(function(){e.isEnter&&(e.content=e.target.dataset.tip,e.isShow=!0,e.$nextTick(e.getPosition))},500))},onMouseleave:function(t){var e=t.target;e.dataset.tip&&(clearTimeout(this.timer),this.isEnter=!1,this.content="",this.isShow=!1)},getPosition:function(){var t=this.target,e=this.$el.clientWidth,o=this.$el.parentNode,i=ct(t,o),n=i.left,s=i.top,r=i.width,l=i.height,a=~~(n+(r-e)/2),c=~~(s+l+10),d=50;a<0&&(a=0),a+e>innerWidth&&(a=innerWidth-e),d=(n-a+r/2)/e*100,this.x=a,this.y=c,this.arrowX=d}}};function wt(t,e,o){var i=[],n=[];return e.forEach(function(s,r){var l=s.type||"paragraph",a=et[l],c=it[l]?n.length+1:null,d=t(a,{props:{value:s,readonly:o},attrs:{"data-index":c,"data-index-num":c?c+".":null,"data-id":s.id},class:c?"editor-list-item":["editor-block","editor-block-"+l],key:s.id,on:{}});if(it[l]){n.push(d);var h=e[r+1];if(!h||h.type!==s.type||h.row!==s.row){var u=t(it[l],{class:["editor-list","editor-list-"+l]},n);i.push(t("div",{class:["editor-block","editor-block-"+l]},[u])),n=[]}}else i.push(d)}),i}var St=wt;function $t(t,e){e||(e={}),e.blocks&&e.blocks instanceof Array||(e.blocks=[]),e.blocks.length||e.blocks.push({type:"paragraph",id:w(),text:"",ranges:[]}),e.blocks.forEach(function(e){t.$set(e,"id",e.id||w()),t.$set(e,"key",0),e.blocks&&e.blocks.length&&$t(e)})}var Bt=o("b012"),Ot=o.n(Bt),Ct=[function(t,e){if(!t.text||"blockquote"===t.type)return!1;var o=/^>\s/,i=t.text.match(o);return i?(t.type="blockquote",t.text=t.text.replace(o,""),t.ranges.forEach(function(t){t.offset-=2}),!0):void 0},function(t,e){if(!t.text)return!1;var o=/^#+\s/,i=t.text.match(o);if(i){t.type="heading";var n=i[0].length-1;return t.level=n>4?4:n,t.text=t.text.replace(o,""),t.ranges.forEach(function(t){t.offset-=i[0].length}),!0}},function(t,e){if(!t.text||"unorderlist"===t.type)return!1;var o=/^(\*|-|\+)\s/,i=t.text.match(o);return i?(t.type="unorderlist",t.text=t.text.replace(o,""),t.ranges.forEach(function(t){t.offset-=2}),!0):void 0},function(t,e){if(!t.text||"orderlist"===t.type)return!1;var o=/^\d\.\s/,i=t.text.match(o);return i?(t.type="orderlist",t.text=t.text.replace(o,""),t.ranges.forEach(function(t){t.offset-=3}),!0):void 0},function(t,e){if(!t.text||"todolist"===t.type)return!1;var o=/^\[(\s|x)?\]\s/,i=t.text.match(o);return i?(t.type="todolist",e.$set(t,"checked",!!i[0].match("x")),t.text=t.text.replace(o,""),t.ranges.forEach(function(t){t.offset-=3}),!0):void 0},function(t){if(!t.text)return!1;var e=/^-{3,10}$/;return t.text.match(e)?(t.type="divider",t.text="",!0):void 0},function(t){if(!t.text||"blockcode"===t.type)return!1;var e=/^`{3}/;return t.text.match(e)?(t.type="blockcode",t.text=t.text.replace(e,""),t.ranges.forEach(function(t){t.offset-=3}),!0):void 0}],Et={name:"editor",props:{readonly:Boolean,value:{type:Object,default:function(){return{}}}},data:function(){return $t(this,this.value),{isComposing:!1,isOperating:!1,isSelecting:!1,isHistoryBacking:!1,isFocus:!1,key:0,selection:{startOffset:null,endOffset:null,startBlock:null,endBlock:null,rangeRect:null,blocks:null,blockStyle:null,inlineStyles:null},history:{index:0,list:[]}}},provide:function(){return{$editor:this}},render:function(t){var e,o,i,n,s=this.value,r=this.readonly;return e=t("article",{attrs:{contenteditable:!r},class:["editor-article",r?"editor-article-readonly":""],on:r?null:{input:this.onInput,paste:this.onPaste,keydown:this.onKeydown,mousedown:this.onMousedown,compositionstart:this.onCompositionstart,compositionend:this.onCompositionend,drop:this.onDrop,"!focus":this.onFocus},ref:"article",key:this.key},St(t,s.blocks,r)),r||(o=t(D,{ref:"popupTool"}),i=t(bt,{ref:"addTool"})),n=t(xt,{ref:"tip"}),t("div",{class:"editor"},[e,o,i,n])},errorCaptured:function(t,e,o){console.log(t,e,o)},mounted:function(){this.addListeners(),this.$once("hook:beforeDestroy",this.removeListeners)},watch:{value:{handler:Ot()(function(t){this.isHistoryBacking?this.isHistoryBacking=!1:this.historyForward()},300),deep:!0},selection:function(t){this.history.list.length||this.historyForward()}},methods:{addListeners:function(){document.addEventListener("selectionchange",this.onSelectionchange),document.addEventListener("mousedown",this.onPageMousedown),document.addEventListener("mouseup",this.onPageMouseup)},removeListeners:function(){document.removeEventListener("selectionchange",this.onSelectionchange),document.removeEventListener("mousedown",this.onPageMousedown)},onPageMousedown:function(t){var e=t.path||t.composedPath&&t.composedPath();if(e.includes(this.$el))this.isFocus=!0;else{for(var o in this.selection)this.selection[o]=null;this.isFocus=!1}},onPageMouseup:function(t){this.isSelecting=!1},onCompositionstart:function(t){this.isComposing=!0},onCompositionend:function(t){this.isComposing=!1,this.onInput(t)},onInput:function(t){var e=this;if(!this.isComposing&&t.srcElement===this.$refs.article&&!this.isHistoryBacking){var o=this.selection,i=o.startBlock,n=o.endBlock,s=o.startOffset,r=o.endOffset;if(i!==n){this.onInputCrossBlocks(),i.text+=t.data||"",yt(i,n),ut(i.ranges),this.removeBlock(n),this.key++;var l=s+(t.data?t.data.length:0);this.setSelection(i,i,l,l)}else{var a=i.text.length,c=rt(i.id),d=c.innerText.length,h={offset:s,length:r-s},u=t.data?t.data.length:d+h.length-a;u<0&&(h.offset+=u,h.length-=u,u=0),pt(i.ranges,h,u),i.text=c.innerText.replace(/\n/g,"");var f=!1;if(Ct.forEach(function(t){var o=t(i,e);o&&(f=!0)}),i.key++,nt(i)){var g=f?0:h.offset+u;this.setSelection(i,i,g,g)}else this.$nextTick(function(){var t=rt(i.id);t&&t.focus()})}}},onInputCrossBlocks:function(){var t=this,e=this.selection,o=e.startBlock,i=e.endBlock,n=e.blocks,s=e.startOffset,r=e.endOffset;if(n.forEach(function(e){(!nt(e)||e!==o&&e!==i)&&t.removeBlock(e)}),nt(o)){var l={offset:s,length:o.text.length-s};pt(o.ranges,l,0),o.text=o.text.substring(0,s)}if(nt(i)){var a={offset:0,length:r};pt(i.ranges,a,0),i.text=i.text.substring(r)}},onPaste:function(t){t.preventDefault();var e=t.clipboardData,o=e.getData("text/plain");if(o){var i=o.split(/\n/).filter(function(t){return t});console.log(i);var n=this.selection,s=n.startBlock,r=n.endBlock,l=n.startOffset,a=n.endOffset;if(1!==i.length||s!==r)i.length;else{if(!nt(s))return;var c=i[0],d={offset:l,length:a-l};pt(s.ranges,d,c.length);var h=s.text;s.text=h.substring(0,l)+c+h.substring(a),s.key++;var u=l+c.length;this.setSelection(s,s,u,u)}}},onDrop:function(t){t.preventDefault()},onKeydown:function(t){if(this.isFocus){var e=t.keyCode,o=t.ctrlKey||t.metaKey;switch(e){case 8:this.onKeyBackspace(t);break;case 9:this.onKeyTab(t);break;case 27:this.onKeyEsc(t);break;case 13:this.onKeyEnter(t);break}if(o)switch(t.keyCode){case 66:t.preventDefault(),this.toggleInlineStyle("bold");break;case 73:t.preventDefault(),this.toggleInlineStyle("italic");break;case 85:t.preventDefault(),this.toggleInlineStyle("underline");break;case 83:break;case 90:this.historyBack();break}}else t.preventDefault()},onKeyBackspace:function(t){var e=this.selection,o=e.startBlock,i=e.endBlock,n=e.startOffset,s=e.endOffset;if(o&&i){var r=this.value.blocks;if(o===i){var l=o.type,a=rt(o.id),c=r[r.indexOf(o)-1],d=c?rt(c.id):null;if(!c){if(!nt(o))return;if(0===n&&0===s){if(t.preventDefault(),"paragraph"===l)return;return this.clearBlockType(),void this.setSelection(o,o,0,0)}}if(n||s)return;if(t.preventDefault(),!nt(o))return this.removeBlock(o),void(nt(c)?this.setSelection(c,c,c.text.length,c.text.length):d.focus());if("paragraph"===l||"blockcode"===l&&"1"!==a.dataset.index){if(!nt(c))return o.text.length||this.removeBlock(o),void d.focus();var h=c.text.length;return yt(c,o),ut(c.ranges),this.removeBlock(o),void this.setSelection(c,c,h,h)}return this.clearBlockType(),void this.setSelection(o,o,0,0)}t.preventDefault(),this.onInputCrossBlocks(),yt(o,i),ut(o.ranges),this.removeBlock(i),this.setSelection(o,o,n,n)}},onKeyEnter:function(t){t.preventDefault();var e=this.selection,o=e.startBlock,i=e.endBlock,n=e.startOffset,s=e.endOffset;if(o!==i)this.onInputCrossBlocks(),this.setSelection(i,i,0,0);else{if(!nt(o)){var r={type:"paragraph",id:w(),key:0,text:"",ranges:[]};return this.addBlockAt(this.value.blocks.indexOf(o)+1,r),void this.setSelection(r,r,0,0)}var l={offset:n,length:s-n},a=vt(o,l),c=o.type,d=this.value.blocks.indexOf(o);if(!it[c])return this.addBlockAt(d+1,a),void this.setSelection(a,a,0,0);if(o.text.length||a.text.length)a.type=c,a.checked=!1,this.addBlockAt(d+1,a),this.setSelection(a,a,0,0);else if("blockcode"!==c)this.clearBlockType(o),this.setSelection(o,o,0,0);else{var h=this.value.blocks[this.value.blocks.indexOf(o)-1];if(!h)return;h.text.length?(a.type=c,this.addBlockAt(d+1,a),this.setSelection(a,a,0,0)):(this.clearBlockType(o),this.setSelection(o,o,0,0))}}},onKeyTab:function(t){var e=this.$refs.addTool;e.isShow&&(t.preventDefault(),e.isOpen=!0,e.$el.querySelector("button").focus())},onKeyEsc:function(t){var e=this.$refs.addTool;e.isShow&&(t.preventDefault(),e.isOpen=!1)},onMousedown:function(t){this.isSelecting=!0,this.isOperating=!1},onFocus:function(t){var e=this;if(this.isFocus=!0,!this.isOperating){console.log("focus");var o=t.target;if("INPUT"!==o.tagName&&"TEXTAREA"!==o.tagName){if(o===this.$refs.article)return this.onSelectionchange(),void(this.$refs.addTool.isOpen=!1);var i=getSelection();if(i&&i.removeAllRanges(),o.dataset.id||(o=st(o)),o){var n=lt(this.value.blocks,o.dataset.id);setTimeout(function(){e.selection={blocks:[n],startBlock:n,endBlock:n,startOffset:null,endOffset:null,rangeRect:ct(o,e.$el),blockStyle:n.type,inlineStyles:null}},60)}}}},onSelectionchange:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.readonly&&!this.isComposing){this.getSelection(),this.getSelectedBlockStyle();var t=this.selection,e=t.startBlock,o=t.endBlock,i=t.startOffset,n=t.endOffset;e===o&&i===n||this.getSelectedInlineStyles()}},getSelection:function(t){function e(){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(){if(!this.isOperating){var t=getSelection();if(t.anchorNode!==this.$refs.article)if("None"!==t.type){var e,o=t.getRangeAt(0);e=o.startContainer===o.endContainer&&o.startOffset===o.endOffset?null:ct(o,this.$el);var i=st(o.startContainer),n=st(o.endContainer);if(i){if(!n){if(!this.selection.endBlock)return this.clearSelection();n=rt(this.selection.endBlock.id)}var s=i.dataset.id,r=n.dataset.id,l=at(this.value.blocks,s,r),a=l[0],c=l[l.length-1],d=dt(i,o.startContainer,o.startOffset),h=dt(n,o.endContainer,o.endOffset);l.length>1&&0===h&&(c=l[l.length-2],h=(c.text||"").length,l.pop()),this.selection={startBlock:a,endBlock:c,startOffset:d,endOffset:h,rangeRect:e,blocks:l}}else this.clearSelection()}else this.clearSelection();else t.removeAllRanges()}}),getSelectedBlockStyle:function(){var t=this.selection.blocks,e=(t||[]).filter(function(t){return nt(t)});if(e&&e.length){var o=e.map(function(t){return"heading"===t.type?t.type+t.level:t.type});o=Array.from(new Set(o)),this.selection.blockStyle=1===o.length?o[0]:null}else this.selection.blockStyle=null},getSelectedInlineStyles:function(){var t=this.selection,e=t.startBlock,o=t.endBlock,i=t.blocks,n=t.startOffset,s=t.endOffset,r=(i||[]).filter(function(t){return nt(t)});if(r&&r.length)if(1!==r.length){var l={},a={};for(var c in r.forEach(function(t){var i={};for(var r in i=t===e?ht(t.ranges,n,t.text.length):ht(t.ranges,0,t===o?s:t.text.length),i)l[r]?l[r].push(i[r]):l[r]=[i[r]]}),l){var d=l[c];d.length===r.length&&(a[c]=1)}this.selection.inlineStyles=a}else this.selection.inlineStyles=ht(r[0].ranges,n,s);else this.selection.inlineStyles=null},addInlineStyle:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.selection,n=i.startBlock,s=i.endBlock,r=i.blocks,l=i.startOffset,a=i.endOffset;if(r&&r.length){if(n===s){if(l===a)return;if("blockcode"===n.type&&"code"===t)return;var c={style:t,offset:l,length:a-l};for(var d in o)this.$set(c,d,o[d]);return n.ranges.push(c),ut(n.ranges),void n.key++}r.forEach(function(i){if(nt(i)&&("blockcode"!==i.type||"code"!==t)){var r={style:t,offset:0,length:0};if(o)for(var c in o)e.$set(r,c,o[c]);i===n?(r.offset=l,r.length=i.text.length-l,i.ranges.push(r)):i===s?(r.length=a,i.ranges.push(r)):(r.length=i.text.length,i.ranges.push(r)),ut(i.ranges),i.key++}})}},removeInlineStyle:function(t){var e=this.selection,o=e.startBlock,i=e.endBlock,n=e.blocks,s=e.startOffset,r=e.endOffset;if(n&&n.length)if(o!==i)n.forEach(function(t){nt(t)&&(t===o?l(t,s,t.text.length):l(t,0,t===i?r:t.text.length))});else{if(s===r)return;l(o,s,r)}function l(e,o,i){var n=e.ranges,s=n.filter(function(e){return e.style===t&&e.offset<=o&&e.offset+e.length>=i})[0];if(s){var r=n.indexOf(s);if(n.splice(r,1),"link"!==s.style){var l={offset:o,length:i-o},a=ft(s,l);e.ranges=n.concat(a)}ut(e.ranges),e.key++}}},toggleInlineStyle:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.selection.inlineStyles;o&&(o[t]?this.removeInlineStyle(t):this.addInlineStyle(t,e),this.restoreSelection())},setBlockType:function(t){var e=this,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.selection.blocks;i.forEach(function(i){if(nt(i))for(var n in e.$set(i,"type",t),"todolist"===t&&e.$set(i,"checked",!1),o)e.$set(i,n,o[n])})},clearBlockType:function(){var t=this,e=this.selection.blocks,o=["type","id","key","text","ranges"];e.forEach(function(e){if(nt(e)){for(var i in e)o.includes(i)||delete e[i];t.$set(e,"type","paragraph"),t.$set(e,"key",0),t.$set(e,"text",e.text||""),t.$set(e,"ranges",e.ranges||[])}})},toggleBlockType:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.selection,i=o.blockStyle,n=o.startBlock,s=t===i;"heading"===n.type&&(s=i===t+e.level),s?this.clearBlockType():this.setBlockType(t,e),this.restoreSelection()},restoreSelection:function(){var t=this.selection,e=t.startBlock,o=t.endBlock,i=t.startOffset,n=t.endOffset;this.setSelection(e,o,i,n)},setSelection:function(t,e,o,i){this.$nextTick(function(){try{var n=rt(t.id),s=rt(e.id),r=gt(n,o),l=t===e&&o===i?r:gt(s,i),a=getSelection(),c=document.createRange();c.setStart(r.focusNode,r.focusOffset),c.setEnd(l.focusNode,l.focusOffset),a.removeAllRanges(),a.addRange(c)}catch(d){console.warn("setRange failed: "+d.message)}})},clearSelection:function(){for(var t in this.selection)this.selection[t]=null},addBlockAt:function(t,e){e&&(e.type=e.type||"paragraph",this.value.blocks.splice(t,0,e))},removeBlock:function(t){if(t){var e=this.value.blocks,o=e.indexOf(t);o<0||e.splice(o,1)}},getValue:function(t){var e=JSON.parse(JSON.stringify(this.value));return e.blocks.forEach(function(t){if(delete t.id,delete t.key,t.ranges&&t.ranges.length){var e=t.text;if(void 0===e&&t.ranges)return void delete t.ranges;t.ranges.forEach(function(o,i){var n=o.offset,s=o.length;n<0&&(o.offset=0),n+s>e.length&&(o.length=e.length-n),s||t.ranges.splice(i,1)})}}),e},historyForward:function(){console.log("history forward");var t=this.history.list,e={value:JSON.stringify(this.value)};e.selection=JSON.stringify(this.selection),t.push(e),t.length>40&&t.shift(),this.history.index=t.length-1||0},historyBack:function(){var t=this.history.list;if(!(t.length<2)){console.log("history back"),this.isHistoryBacking=!0,t.pop();var e=t[t.length-1];this.value.blocks=JSON.parse(e.value).blocks,this.selection=JSON.parse(e.selection),this.restoreSelection()}}}},Tt={components:{Editor:Et},data:function(){return{readonly:!1,testValue:r,selection:{}}},methods:{getValue:function(){console.log(this.$refs.editor.getValue())},onSelectionchange:function(t){this.selection=t},onFileChange:function(t){var e=t.target.files[0];console.log(e);var o=URL.createObjectURL(e),i=new Image;i.src=o,document.body.appendChild(i)}}},At=Tt,It=(o("5c0b"),o("2877")),Mt=Object(It["a"])(At,n,s,!1,null,null,null),Pt=Mt.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(Pt)}}).$mount("#app")},"5c0b":function(t,e,o){"use strict";var i=o("5e27"),n=o.n(i);n.a},"5e27":function(t,e,o){},f164:function(t){t.exports={blocks:[{type:"paragraph",text:"尝试编辑这篇文章",ranges:[]},{text:'CSS Utility Classes and "Separation of Concerns"',ranges:[{style:"bold",offset:25,length:22}],type:"heading",level:1},{type:"blockquote",text:'Over the last several years, the way I write CSS has transitioned from a very "semantic" approach to something much more like what is often called "functional CSS."the way I write CSS has transitioned from a very "semantic" approach to something much more like what is often.',ranges:[{style:"bold",offset:79,length:8},{style:"hilight",offset:79,length:8}]},{text:"Writing CSS this way can evoke a pretty visceral reaction from a lot of developers, so I'd like to explain how I got to this point and share some of the lessons and insights I've picked up along the way.",ranges:[{style:"hilight",offset:0,length:1}],type:"paragraph"},{type:"video",src:"https://cdn.plyr.io/static/demo/View_From_A_Blue_Moon_Trailer-576p.mp4",name:"View From A Blue Moon Trailer",poster:"https://cdn.plyr.io/static/demo/View_From_A_Blue_Moon_Trailer-HD.jpg",text:"",width:1024,height:576},{text:'Phase 1: "Semantic" CSS',ranges:[{style:"link",offset:10,length:8,href:"https://www.google.com"}],type:"heading",level:2},{text:"One of the best practices you'll hear about when you're trying to learn how to CSS good is \"separation of concerns.\" The idea is that your HTML should only contain information about your content, and all of your styling decisions should be made in your CSS.",ranges:[{style:"code",offset:253,length:3},{style:"code",offset:139,length:4}],type:"paragraph"},{text:"Write the markup I needed for some new UI (an author bio card in this case).",ranges:[],type:"todolist",checked:!0},{text:"Add a descriptive class or two based on the content.",ranges:[],type:"todolist",checked:!1},{text:'Use those classes as "hooks" in my CSS/Less/Sass to style my new markup.',ranges:[{style:"code",offset:35,length:13},{style:"code",offset:22,length:5}],type:"todolist",checked:!1},{text:"Take a look at this HTML:",ranges:[],type:"paragraph"},{type:"blockcode",level:2,text:'<p class="text-center">',ranges:[]},{text:"    Hello there!",ranges:[],type:"blockcode",checked:!1},{type:"blockcode",text:"</p>",ranges:[]},{type:"paragraph",text:'See that .text-center class? Centering text is a design decision, so this code violates "separation of concerns" because we\'ve let styling information bleed into our HTML.',ranges:[{style:"code",offset:9,length:12}]},{type:"divider"},{type:"image",src:"https://images.unsplash.com/photo-1567091318296-08346e7e99d5?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=634&q=80",row:"89ds02j0sk1",text:"This is an image",width:634,height:951,alt:"Test-image.jpg"},{type:"image",src:"https://images.unsplash.com/photo-1565551828813-9e8455aab496?ixlib=rb-1.2.1&auto=format&fit=crop&w=1500&q=80",row:"89ds02j0sk1",text:"",width:1500,height:1e3,alt:"Test-image.jpg"},{text:'The quintessential example of this approach has always been CSS Zen Garden; a site designed to show that if you "separate your concerns", you can completely redesign a site just by swapping out the stylesheet.',ranges:[],type:"paragraph"},{type:"attach",name:"3WEKJXC9SD6A5VC8FG5A0A7D6DA9Z.png",url:"https://images.unsplash.com/photo-1565551828813-9e8455aab496?ixlib=rb-1.2.1&auto=format&fit=crop&w=1500&q=80",size:174859,ext:"png"},{type:"table",rows:[["Name","Email","Age"],["Jhon","jhon@gmail.com","28"],["","",""]]},{text:"My workflow looked something like this:",ranges:[],type:"paragraph"},{text:"Write the markup I needed for some new UI (an author bio card in this case).",ranges:[],type:"orderlist"},{text:"Add a descriptive class or two based on the content.",ranges:[],type:"orderlist",checked:!1},{text:'Use those classes as "hooks" in my CSS/Less/Sass to style my new markup.',ranges:[{style:"code",offset:35,length:13},{style:"code",offset:22,length:5}],type:"orderlist",checked:!1},{text:"My markup wasn't concerned with styling decisions, but my CSS was very concerned with my markup structure.",ranges:[{style:"bold",offset:0,length:106}],type:"paragraph",checked:!1},{text:"",ranges:[],type:"divider"},{text:"上面一段英文是随便抄写的，用来展示效果",ranges:[{style:"hilight",offset:0,length:19}],type:"paragraph",level:2},{text:"Markdown 语法快速格式化（在段落开始出输入）",ranges:[],type:"heading",level:3},{text:"引用：>空格",ranges:[{style:"code",offset:3,length:3}],type:"unorderlist"},{text:"标题：#空格、 ##空格、 ###空格、 ####空格",ranges:[{style:"code",offset:3,length:3},{style:"code",offset:8,length:4},{style:"code",offset:14,length:5},{style:"code",offset:21,length:6}],type:"unorderlist",checked:!1},{text:"列表：-空格 、 +空格、 *空格",ranges:[{style:"code",offset:3,length:3},{style:"code",offset:9,length:3},{style:"code",offset:14,length:3}],type:"unorderlist",checked:!1},{text:"有序列表：1.空格",ranges:[{style:"code",offset:5,length:4}],type:"unorderlist",checked:!1},{text:"Todo： 未勾选[]空格 、勾选[x]空格",ranges:[{style:"code",offset:17,length:5},{style:"code",offset:9,length:4}],type:"unorderlist",checked:!1},{text:"代码块： ```",ranges:[{style:"code",offset:5,length:3}],type:"unorderlist",checked:!1},{text:"分隔符： ---",ranges:[{style:"code",offset:5,length:3}],type:"unorderlist",checked:!1},{text:"开发进度",ranges:[],type:"heading",level:3},{text:"文字全文编辑功能 (由区域编辑重构)",ranges:[],type:"todolist",checked:!0},{text:"上下文工具条",ranges:[],type:"todolist",checked:!0},{text:"Markdown 语法快速格式化 Block",ranges:[],type:"todolist",checked:!0},{text:"Heading 组件",ranges:[],type:"todolist",checked:!0},{text:"List 组件",ranges:[],type:"todolist",checked:!0},{text:"Todo 组件",ranges:[],type:"todolist",checked:!0},{text:"Blockcode 组件",ranges:[],type:"todolist",checked:!0},{text:"Blockquote 组件",ranges:[],type:"todolist",checked:!0},{text:"单行的粘贴",ranges:[],type:"todolist",checked:!0},{text:"历史记录功能",ranges:[],type:"todolist",checked:!0},{text:"多行粘贴和跨行粘贴",ranges:[],type:"todolist",checked:!1},{text:"标题导航功能",ranges:[],type:"todolist",checked:!1},{text:"Block 工具条",ranges:[],type:"todolist",checked:!0},{text:"链接鼠标悬停显示和点击访问",ranges:[],type:"todolist",checked:!0},{text:"Image 组件(开发中)",ranges:[],type:"todolist",checked:!0},{text:"Video组件",ranges:[],type:"todolist",checked:!0},{text:"Audio 组件",ranges:[],type:"todolist",checked:!1},{text:"Chart 组件",ranges:[],type:"todolist",checked:!1},{text:"Table 组件",ranges:[],type:"todolist",checked:!0},{text:"Attach 组件",ranges:[],type:"todolist",checked:!0},{text:"区块的拖动排序",ranges:[],type:"todolist",checked:!1},{text:"其它功能",ranges:[],type:"heading",checked:!1,level:4},{text:"Json、Markdown 互相转换功能",ranges:[],type:"todolist",checked:!1},{text:"inline 组件的 Markdown 语法快速格式化",ranges:[{style:"code",offset:0,length:6}],type:"todolist",checked:!1},{text:"",ranges:[],type:"paragraph"}]}},fa44:function(t,e,o){}});